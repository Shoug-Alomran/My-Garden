<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PSU CCIS ¬∑ SE-CYS Degree Checklist</title>

  <!-- ‚úÖ EARLY THEME SYNC (prevents flash + actually works with MkDocs Material) -->
  <script>
    (function () {
      function readParentScheme() {
        try {
          const scheme = parent?.document?.documentElement?.getAttribute("data-md-color-scheme");
          if (!scheme) return null;
          return scheme === "slate" ? "dark" : "light";
        } catch (e) {
          return null;
        }
      }

      function readMaterialPalette() {
        // Material stores palette under "__palette" (via __md_get) OR localStorage "__palette"
        try {
          if (typeof window.__md_get === "function") {
            const p = window.__md_get("__palette");
            const scheme = p?.color?.scheme;
            if (scheme) return scheme === "slate" ? "dark" : "light";
          }
        } catch (e) { }

        try {
          const raw = localStorage.getItem("__palette");
          if (!raw) return null;
          const p = JSON.parse(raw);
          const scheme = p?.color?.scheme;
          if (scheme) return scheme === "slate" ? "dark" : "light";
        } catch (e) { }

        return null;
      }

      function readOS() {
        try {
          return window.matchMedia("(prefers-color-scheme: light)").matches ? "light" : "dark";
        } catch (e) {
          return "dark";
        }
      }

      function decideMode() {
        return readParentScheme() || readMaterialPalette() || readOS();
      }

      const mode = decideMode();
      // Your CSS uses .light on BODY
      if (mode === "light") document.documentElement.classList.add("force-light");
      // We'll actually add body.light once body exists (below), but this avoids flash.
    })();
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600;700&display=swap');

    :root {
      --bg: #0c0e14;
      --bg2: #12151f;
      --bg3: #181c29;
      --panel: rgba(255, 255, 255, 0.04);
      --panel-hover: rgba(255, 255, 255, 0.07);
      --border: rgba(255, 255, 255, 0.08);
      --border-bright: rgba(255, 255, 255, 0.18);
      --accent: #4f9eff;
      --accent2: #7c6af7;
      --green: #34d399;
      --yellow: #fbbf24;
      --red: #f87171;
      --text: #e8ecf4;
      --text2: #8892aa;
      --text3: #4d566b;
      --card-radius: 12px;
      --trans: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
    }

    /* Light theme tokens (applied via body.light) */
    body.light {
      --bg: #f0f2f8;
      --bg2: #e6e9f4;
      --bg3: #dde1ef;
      --panel: rgba(255, 255, 255, 0.7);
      --panel-hover: rgba(255, 255, 255, 0.9);
      --border: rgba(0, 0, 0, 0.08);
      --border-bright: rgba(0, 0, 0, 0.18);
      --accent: #2563eb;
      --accent2: #7c3aed;
      --green: #059669;
      --yellow: #d97706;
      --red: #dc2626;
      --text: #1e2433;
      --text2: #4b5568;
      --text3: #9ca3af;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
    }

    /* Background grid */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(79, 158, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(79, 158, 255, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    /* make grid softer in light mode */
    body.light::before {
      background-image:
        linear-gradient(rgba(37, 99, 235, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(37, 99, 235, 0.05) 1px, transparent 1px);
    }

    .app {
      position: relative;
      z-index: 1;
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 60px;
    }

    /* HEADER */
    .header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 32px;
      flex-wrap: wrap;
    }

    .header-left h1 {
      font-family: 'Space Mono', monospace;
      font-size: 22px;
      font-weight: 700;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-left p {
      color: var(--text2);
      font-size: 12px;
      margin-top: 4px;
    }

    .header-right {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 8px 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--trans);
      white-space: nowrap;
    }

    .btn:hover {
      background: var(--panel-hover);
      border-color: var(--border-bright);
    }

    .btn-accent {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .btn-accent:hover {
      filter: brightness(1.1);
    }

    .btn-sm {
      padding: 6px 10px;
      font-size: 11px;
    }

    /* PROGRESS PANEL */
    .progress-panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--card-radius);
      padding: 20px 24px;
      margin-bottom: 24px;
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
    }

    .progress-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }

    .stat {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .stat-val {
      font-family: 'Space Mono', monospace;
      font-size: 26px;
      font-weight: 700;
      color: var(--accent);
    }

    .stat-label {
      font-size: 11px;
      color: var(--text2);
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }

    .progress-bar-wrap {
      background: var(--border);
      border-radius: 100px;
      height: 6px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      border-radius: 100px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .progress-pct {
      font-size: 11px;
      color: var(--text2);
      margin-top: 6px;
      text-align: right;
    }

    /* CHOICE GROUPS */
    .choice-groups {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .choice-group {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--card-radius);
      padding: 14px 18px;
      flex: 1;
      min-width: 240px;
      backdrop-filter: blur(10px);
    }

    .choice-group h4 {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text2);
      margin-bottom: 10px;
    }

    .choice-options {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .choice-opt {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text2);
      font-size: 12px;
      cursor: pointer;
      transition: var(--trans);
      font-family: 'DM Sans', sans-serif;
      font-weight: 500;
    }

    .choice-opt.selected {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: transparent;
      color: #fff;
    }

    .choice-opt:not(.selected):hover {
      border-color: var(--border-bright);
      color: var(--text);
    }

    /* CONTROLS */
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      align-items: center;
    }

    .search-wrap {
      flex: 1;
      min-width: 200px;
      position: relative;
    }

    .search-wrap input {
      width: 100%;
      padding: 9px 14px 9px 36px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      outline: none;
      transition: var(--trans);
      backdrop-filter: blur(10px);
    }

    .search-wrap input:focus {
      border-color: var(--accent);
    }

    .search-wrap input::placeholder {
      color: var(--text3);
    }

    .search-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text3);
    }

    .filter-tabs {
      display: flex;
      gap: 4px;
    }

    .filter-tab {
      padding: 7px 12px;
      border-radius: 7px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text2);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--trans);
      font-family: 'DM Sans', sans-serif;
    }

    .filter-tab.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .filter-tab:not(.active):hover {
      background: var(--panel-hover);
    }

    /* LEVEL SECTION */
    .level-section {
      margin-bottom: 16px;
    }

    .level-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 4px;
      margin-bottom: 8px;
      cursor: pointer;
      user-select: none;
    }

    .level-badge {
      font-family: 'Space Mono', monospace;
      font-size: 10px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 1px;
    }

    .level-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      flex: 1;
    }

    .level-meta {
      font-size: 11px;
      color: var(--text2);
    }

    .level-toggle {
      color: var(--text3);
      transition: transform 0.2s;
    }

    .level-section.collapsed .level-toggle {
      transform: rotate(-90deg);
    }

    .level-section.collapsed .level-body {
      display: none;
    }

    /* COURSE CARD */
    .course-card {
      display: grid;
      grid-template-columns: 36px 100px 1fr auto;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: var(--card-radius);
      border: 1px solid var(--border);
      background: var(--panel);
      margin-bottom: 6px;
      cursor: pointer;
      transition: var(--trans);
      backdrop-filter: blur(6px);
      position: relative;
      overflow: hidden;
    }

    .course-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--border);
      border-radius: 3px 0 0 3px;
      transition: var(--trans);
    }

    .course-card:hover {
      background: var(--panel-hover);
      border-color: var(--border-bright);
      transform: translateX(2px);
    }

    .course-card.completed::before {
      background: var(--green);
    }

    .course-card.locked {
      opacity: 0.55;
      cursor: not-allowed;
    }

    .course-card.locked:hover {
      transform: none;
    }

    .course-card.available::before {
      background: var(--accent);
    }

    .course-card.highlighted {
      border-color: var(--yellow);
      background: rgba(251, 191, 36, 0.08);
    }

    /* Checkbox */
    .course-check {
      width: 22px;
      height: 22px;
      border-radius: 6px;
      border: 2px solid var(--border-bright);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--trans);
      flex-shrink: 0;
      background: transparent;
    }

    .course-card.completed .course-check {
      background: var(--green);
      border-color: var(--green);
    }

    .course-check svg {
      opacity: 0;
      transform: scale(0.5);
      transition: var(--trans);
    }

    .course-card.completed .course-check svg {
      opacity: 1;
      transform: scale(1);
    }

    .course-id {
      font-family: 'Space Mono', monospace;
      font-size: 11px;
      font-weight: 700;
      color: var(--accent);
      white-space: nowrap;
    }

    .course-info {
      min-width: 0;
    }

    .course-name {
      font-size: 13px;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 4px;
    }

    .course-prereqs {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }

    .prereq-chip {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      background: rgba(79, 158, 255, 0.12);
      color: var(--accent);
      border: 1px solid rgba(79, 158, 255, 0.2);
      cursor: pointer;
      transition: var(--trans);
      font-family: 'Space Mono', monospace;
      white-space: nowrap;
    }

    body.light .prereq-chip {
      background: rgba(37, 99, 235, 0.10);
      border-color: rgba(37, 99, 235, 0.18);
    }

    .prereq-chip:hover {
      background: rgba(79, 158, 255, 0.25);
    }

    .prereq-chip.missing {
      background: rgba(248, 113, 113, 0.12);
      color: var(--red);
      border-color: rgba(248, 113, 113, 0.2);
    }

    .course-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      flex-shrink: 0;
    }

    .course-hours {
      font-size: 11px;
      color: var(--text2);
      white-space: nowrap;
    }

    .status-badge {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 20px;
      white-space: nowrap;
      letter-spacing: 0.5px;
    }

    .badge-completed {
      background: rgba(52, 211, 153, 0.15);
      color: var(--green);
      border: 1px solid rgba(52, 211, 153, 0.3);
    }

    .badge-available {
      background: rgba(79, 158, 255, 0.15);
      color: var(--accent);
      border: 1px solid rgba(79, 158, 255, 0.3);
    }

    .badge-locked {
      background: rgba(255, 255, 255, 0.05);
      color: var(--text3);
      border: 1px solid var(--border);
    }

    .badge-not-selected {
      background: rgba(251, 191, 36, 0.1);
      color: var(--yellow);
      border: 1px solid rgba(251, 191, 36, 0.2);
    }

    /* TOAST */
    #toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-width: 360px;
    }

    .toast {
      padding: 12px 18px;
      border-radius: 10px;
      background: var(--bg3);
      border: 1px solid var(--border-bright);
      color: var(--text);
      font-size: 13px;
      box-shadow: var(--shadow);
      animation: toastIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      backdrop-filter: blur(20px);
    }

    .toast.error {
      border-color: rgba(248, 113, 113, 0.4);
    }

    .toast.success {
      border-color: rgba(52, 211, 153, 0.4);
    }

    @keyframes toastIn {
      from {
        opacity: 0;
        transform: translateY(12px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes toastOut {
      from {
        opacity: 1;
        transform: translateY(0);
      }

      to {
        opacity: 0;
        transform: translateY(12px);
      }
    }

    /* MODAL */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(4px);
      animation: fadeIn 0.2s;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .modal {
      background: var(--bg2);
      border: 1px solid var(--border-bright);
      border-radius: 16px;
      padding: 28px;
      max-width: 440px;
      width: 90%;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.6);
      animation: modalIn 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes modalIn {
      from {
        opacity: 0;
        transform: scale(0.95);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .modal h3 {
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .modal p {
      font-size: 13px;
      color: var(--text2);
      line-height: 1.6;
      margin-bottom: 16px;
    }

    .modal ul {
      list-style: none;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .modal ul li {
      font-size: 12px;
      padding: 5px 10px;
      background: var(--panel);
      border-radius: 6px;
      font-family: 'Space Mono', monospace;
      color: var(--red);
    }

    .modal-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: var(--text3);
      font-size: 13px;
    }

    @media (max-width: 600px) {
      .course-card {
        grid-template-columns: 30px 80px 1fr auto;
        gap: 8px;
        padding: 10px 12px;
      }

      .course-name {
        font-size: 12px;
      }
    }
  </style>
  <script src="/javascripts/standalone-theme.js"></script>
</head>

<body>
  <div class="app">
    <!-- HEADER -->
    <div class="header">
      <div class="header-left">
        <h1>PSU CCIS ¬∑ SE-CYS</h1>
        <p>Software Engineering (Cybersecurity) ‚Äî Degree Checklist</p>
      </div>
      <div class="header-right">
        <button class="btn btn-sm" id="mark13Btn">‚ú¶ Mark L1‚Äì3 Complete</button>
        <button class="btn btn-sm" id="markAllBtn">‚ú¶ Mark All Complete</button>
        <button class="btn btn-sm" id="resetBtn">‚ü≥ Reset</button>
        <button class="btn btn-sm" id="themeToggle">‚óê Toggle Theme</button>
      </div>
    </div>

    <!-- PROGRESS -->
    <div class="progress-panel">
      <div class="progress-stats">
        <div class="stat">
          <span class="stat-val" id="statHours">0</span>
          <span class="stat-label">Credit Hours Completed</span>
        </div>
        <div class="stat">
          <span class="stat-val" id="statTotal">‚Äî</span>
          <span class="stat-label">Total Hours</span>
        </div>
        <div class="stat">
          <span class="stat-val" id="statCourses">0</span>
          <span class="stat-label">Courses Completed</span>
        </div>
        <div class="stat">
          <span class="stat-val" id="statTotal2">‚Äî</span>
          <span class="stat-label">Total Courses</span>
        </div>
      </div>
      <div class="progress-bar-wrap">
        <div class="progress-bar-fill" id="progressBar" style="width:0%"></div>
      </div>
      <div class="progress-pct" id="progressPct">0% completed</div>
    </div>

    <!-- CHOICE GROUPS -->
    <div class="choice-groups">
      <div class="choice-group">
        <h4>Group A ‚Äî Choose 1 Math</h4>
        <div class="choice-options">
          <button class="choice-opt selected" data-group="A" data-val="MATH223">MATH223 ¬∑ Linear Algebra</button>
          <button class="choice-opt" data-group="A" data-val="CS223">CS223 ¬∑ Computational Linear Algebra</button>
        </div>
      </div>
      <div class="choice-group">
        <h4>Group B ‚Äî Choose 1 CYS Elective</h4>
        <div class="choice-options">
          <button class="choice-opt selected" data-group="B" data-val="CYS406">CYS406 ¬∑ Data & Network Security</button>
          <button class="choice-opt" data-group="B" data-val="CYS404">CYS404 ¬∑ Cyber-Physical Systems Security</button>
        </div>
      </div>
    </div>

    <!-- CONTROLS -->
    <div class="controls">
      <div class="search-wrap">
        <span class="search-icon">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.35-4.35" />
          </svg>
        </span>
        <input type="text" id="searchInput" placeholder="Search by code or name‚Ä¶" />
      </div>
      <div class="filter-tabs">
        <button class="filter-tab active" data-filter="all">All</button>
        <button class="filter-tab" data-filter="completed">Completed</button>
        <button class="filter-tab" data-filter="available">Available</button>
        <button class="filter-tab" data-filter="locked">Locked</button>
      </div>
    </div>

    <!-- COURSE LIST -->
    <div id="courseList"></div>
  </div>

  <!-- TOAST -->
  <div id="toast-container"></div>

  <script>
    const COURSES_RAW = [
      // Level 1
      { id: 'ARAB101', name: 'Arabic Writing', hours: 2, level: 1, prereqs: [] },
      { id: 'ENG101', name: 'Intensive Writing', hours: 3, level: 1, prereqs: [] },
      { id: 'ISC101', name: 'Islamic Ethics', hours: 2, level: 1, prereqs: [] },
      { id: 'CS101', name: 'Computer Programming I', hours: 4, level: 1, prereqs: [] },
      { id: 'MATH111', name: 'Calculus I', hours: 3, level: 1, prereqs: [] },
      { id: 'CHM101', name: 'General Chemistry', hours: 4, level: 1, prereqs: [] },
      // Level 2
      { id: 'CS102', name: 'Computer Programming II', hours: 3, level: 2, prereqs: ['CS101'] },
      { id: 'CS175', name: 'Digital Logic & Computer Organization', hours: 3, level: 2, prereqs: ['CS101'] },
      { id: 'ENG103', name: 'Research Writing Techniques', hours: 3, level: 2, prereqs: ['ENG101'] },
      { id: 'STAT101', name: 'Introduction to Statistics & Probability', hours: 3, level: 2, prereqs: ['MATH111'] },
      { id: 'MATH113', name: 'Calculus II', hours: 3, level: 2, prereqs: ['MATH111'] },
      { id: 'ISC103', name: 'Islamic Economic System', hours: 2, level: 2, prereqs: [] },
      // Level 3
      { id: 'SE201', name: 'Introduction to Software Engineering', hours: 3, level: 3, prereqs: ['CS102', 'ENG103'] },
      { id: 'PHY105', name: 'Physics I', hours: 4, level: 3, prereqs: ['MATH111'] },
      { id: 'CS285', name: 'Discrete Math for Computing', hours: 3, level: 3, prereqs: ['CS210'] },
      { id: 'CS210', name: 'Data Structures & Algorithms', hours: 3, level: 3, prereqs: ['CS102'] },
      { id: 'ISC105', name: 'Holy Quran Sciences', hours: 2, level: 3, prereqs: [] },
      { id: 'COM201', name: 'Communication Skills', hours: 3, level: 3, prereqs: [] },
      // Level 4
      { id: 'SE365', name: 'Human‚ÄìComputer Interaction', hours: 3, level: 4, prereqs: ['CS210'] },
      { id: 'SE311', name: 'Software Requirements Engineering', hours: 3, level: 4, prereqs: ['SE201'] },
      { id: 'PHY205', name: 'Physics II', hours: 4, level: 4, prereqs: ['PHY105'] },
      { id: 'CS330', name: 'Introduction to Operating Systems', hours: 3, level: 4, prereqs: ['CS175', 'CS210'] },
      { id: 'PSY101', name: 'Introduction to Psychology', hours: 3, level: 4, prereqs: [] },
      // Level 5
      { id: 'SE322', name: 'Software Design & Architecture', hours: 3, level: 5, prereqs: ['SE311'] },
      { id: 'CYS401', name: 'Fundamentals of Cybersecurity', hours: 3, level: 5, prereqs: ['CS210'] },
      { id: 'CS340', name: 'Introduction to Database Systems', hours: 3, level: 5, prereqs: ['CS210'] },
      { id: 'CS331', name: 'Data Communications & Computer Networks', hours: 3, level: 5, prereqs: ['CS175', 'CS210'] },
      { id: 'ISC203', name: 'Contemporary Financial Transactions', hours: 2, level: 5, prereqs: [] },
      { id: 'ARAB103', name: 'Professional & Literary Writing', hours: 2, level: 5, prereqs: [] },
      // Level 6
      { id: 'CYS403', name: 'Cybersecurity Risk, Governance & Compliance', hours: 3, level: 6, prereqs: ['CYS401'] },
      { id: 'CYS402', name: 'Secure Software Development', hours: 3, level: 6, prereqs: ['CYS401'] },
      { id: 'SE401', name: 'Software Testing & Quality Assurance', hours: 3, level: 6, prereqs: ['SE322'] },
      { id: 'SE371', name: 'Web Engineering', hours: 3, level: 6, prereqs: ['CS210'] },
      { id: 'MATH221', name: 'Numerical Analysis', hours: 3, level: 6, prereqs: ['MATH113'] },
      { id: 'ETHC303', name: 'Ethical & Social Aspects of Computing', hours: 3, level: 6, prereqs: [] },
      // Level 7
      { id: 'CYS405', name: 'Penetration Testing & Ethical Hacking', hours: 3, level: 7, prereqs: ['CS331', 'CYS401'] },
      { id: 'SE499', name: 'Senior Project', hours: 3, level: 7, prereqs: ['SE423'] },
      { id: 'SE423', name: 'Software Engineering Project Management', hours: 3, level: 7, prereqs: ['SE401'] },
      { id: 'SE411', name: 'Software Construction', hours: 3, level: 7, prereqs: ['SE401'] },
      { id: 'ARAB203', name: 'Arabic Grammar', hours: 2, level: 7, prereqs: [] },
      // Level 8
      { id: 'SE492', name: 'Cooperative Training', hours: 10, level: 8, prereqs: ['SE499'] },
      // Choice Groups
      { id: 'MATH223', name: 'Linear Algebra', hours: 3, level: 6, prereqs: ['MATH113'], group: 'A' },
      { id: 'CS223', name: 'Computational Linear Algebra', hours: 3, level: 6, prereqs: ['CS101', 'MATH113'], group: 'A' },
      { id: 'CYS406', name: 'Data & Network Security', hours: 3, level: 7, prereqs: ['CS331', 'CYS401'], group: 'B' },
      { id: 'CYS404', name: 'Cyber-Physical Systems Security', hours: 3, level: 7, prereqs: ['CS331', 'CYS401'], group: 'B' },
    ];

    // State
    let completed = new Set();
    let choices = { A: 'MATH223', B: 'CYS406' };
    let searchQ = '';
    let filterMode = 'all';
    let highlighted = null;

    // Theme state
    let dark = true;

    function save() {
      localStorage.setItem('psu_completed', JSON.stringify([...completed]));
      localStorage.setItem('psu_choices', JSON.stringify(choices));
      localStorage.setItem('psu_theme', dark ? 'dark' : 'light');
    }

    function load() {
      try {
        const c = localStorage.getItem('psu_completed');
        if (c) completed = new Set(JSON.parse(c));
        const ch = localStorage.getItem('psu_choices');
        if (ch) choices = JSON.parse(ch);
      } catch (e) { }
    }

    /* ‚úÖ REAL THEME SYNC (MkDocs Material + fallbacks) */
    function getMkDocsMode() {
      // 1) parent attribute (iframe + same-origin)
      try {
        const scheme = parent?.document?.documentElement?.getAttribute("data-md-color-scheme");
        if (scheme) return scheme === "slate" ? "dark" : "light";
      } catch (e) { }

      // 2) this page attribute
      try {
        const scheme = document.documentElement.getAttribute("data-md-color-scheme");
        if (scheme) return scheme === "slate" ? "dark" : "light";
      } catch (e) { }

      // 3) Material palette storage
      try {
        if (typeof window.__md_get === "function") {
          const p = window.__md_get("__palette");
          const scheme = p?.color?.scheme;
          if (scheme) return scheme === "slate" ? "dark" : "light";
        }
      } catch (e) { }

      try {
        const raw = localStorage.getItem("__palette");
        if (raw) {
          const p = JSON.parse(raw);
          const scheme = p?.color?.scheme;
          if (scheme) return scheme === "slate" ? "dark" : "light";
        }
      } catch (e) { }

      // 4) OS fallback
      try {
        return window.matchMedia("(prefers-color-scheme: light)").matches ? "light" : "dark";
      } catch (e) {
        return "dark";
      }
    }

    function applyTheme(mode) {
      // mode: "light" | "dark"
      dark = (mode === "dark");
      document.body.classList.toggle('light', mode === 'light');
      localStorage.setItem('psu_theme', mode);
    }

    function initTheme() {
      // If user previously toggled inside THIS page, respect it
      const saved = localStorage.getItem('psu_theme');
      if (saved === 'light' || saved === 'dark') {
        applyTheme(saved);
        return;
      }

      // Otherwise follow MkDocs/Material if possible
      const mode = getMkDocsMode();
      applyTheme(mode);
    }

    function watchThemeChanges() {
      // Watch parent <html data-md-color-scheme> changes
      try {
        const target = parent.document.documentElement;
        new MutationObserver(() => {
          // if user has set local override via our own toggle, don't override
          const saved = localStorage.getItem('psu_theme');
          if (saved === 'light' || saved === 'dark') return;
          applyTheme(getMkDocsMode());
        }).observe(target, { attributes: true, attributeFilter: ["data-md-color-scheme"] });
      } catch (e) { }

      // Watch this page attribute changes too
      try {
        const target2 = document.documentElement;
        new MutationObserver(() => {
          const saved = localStorage.getItem('psu_theme');
          if (saved === 'light' || saved === 'dark') return;
          applyTheme(getMkDocsMode());
        }).observe(target2, { attributes: true, attributeFilter: ["data-md-color-scheme"] });
      } catch (e) { }

      // OS changes
      try {
        const mq = window.matchMedia("(prefers-color-scheme: light)");
        const handler = () => {
          const saved = localStorage.getItem('psu_theme');
          if (saved === 'light' || saved === 'dark') return;
          applyTheme(getMkDocsMode());
        };
        mq.addEventListener ? mq.addEventListener("change", handler) : mq.addListener(handler);
      } catch (e) { }
    }

    // Active courses = only selected choice
    function getActiveCourses() {
      return COURSES_RAW.filter(c => {
        if (c.group === 'A') return c.id === choices.A;
        if (c.group === 'B') return c.id === choices.B;
        return true;
      });
    }

    function getStatus(course) {
      if (completed.has(course.id)) return 'completed';
      const prereqsMet = course.prereqs.every(p => completed.has(p));
      return prereqsMet ? 'available' : 'locked';
    }

    function getDependents(courseId) {
      return getActiveCourses().filter(c => c.prereqs.includes(courseId));
    }

    function getAllDependents(courseId) {
      const result = new Set();
      const queue = [courseId];
      while (queue.length) {
        const cur = queue.shift();
        getDependents(cur).forEach(dep => {
          if (!result.has(dep.id)) {
            result.add(dep.id);
            queue.push(dep.id);
          }
        });
      }
      return [...result];
    }

    function updateProgress() {
      const active = getActiveCourses();
      const total = active.length;
      const done = active.filter(c => completed.has(c.id)).length;
      const th = active.reduce((s, c) => s + c.hours, 0);
      const ch = active.filter(c => completed.has(c.id)).reduce((s, c) => s + c.hours, 0);
      const pct = th > 0 ? Math.round(ch / th * 100) : 0;

      document.getElementById('statHours').textContent = ch;
      document.getElementById('statTotal').textContent = th;
      document.getElementById('statCourses').textContent = done;
      document.getElementById('statTotal2').textContent = total;
      document.getElementById('progressBar').style.width = pct + '%';
      document.getElementById('progressPct').textContent = pct + '% completed';
    }

    function render() {
      updateProgress();
      const active = getActiveCourses();
      const levels = [...new Set(active.map(c => c.level))].sort((a, b) => a - b);
      const list = document.getElementById('courseList');
      const q = searchQ.toLowerCase();

      list.innerHTML = '';

      levels.forEach(level => {
        let courses = active.filter(c => c.level === level).sort((a, b) => a.id.localeCompare(b.id));

        let filtered = courses.filter(c => {
          if (q && !c.id.toLowerCase().includes(q) && !c.name.toLowerCase().includes(q)) return false;
          const status = getStatus(c);
          if (filterMode === 'completed' && status !== 'completed') return false;
          if (filterMode === 'available' && status !== 'available') return false;
          if (filterMode === 'locked' && status !== 'locked') return false;
          return true;
        });

        if (filtered.length === 0) return;

        const levelNames = { 1: 'Level 1', 2: 'Level 2', 3: 'Level 3', 4: 'Level 4', 5: 'Level 5', 6: 'Level 6', 7: 'Level 7', 8: 'Level 8' };
        const doneCount = filtered.filter(c => completed.has(c.id)).length;

        const section = document.createElement('div');
        section.className = 'level-section';
        section.innerHTML = `
          <div class="level-header">
            <span class="level-badge">LVL ${level}</span>
            <span class="level-title">${levelNames[level]}</span>
            <span class="level-meta">${doneCount}/${filtered.length} ¬∑ ${filtered.reduce((s, c) => s + c.hours, 0)} hrs</span>
            <span class="level-toggle">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
            </span>
          </div>
          <div class="level-body"></div>
        `;

        section.querySelector('.level-header').addEventListener('click', () => {
          section.classList.toggle('collapsed');
        });

        const body = section.querySelector('.level-body');

        filtered.forEach(course => {
          const status = getStatus(course);
          const card = document.createElement('div');
          card.className = `course-card ${status}${highlighted === course.id ? ' highlighted' : ''}`;
          card.dataset.id = course.id;

          const prereqsHtml = course.prereqs.map(p => {
            const met = completed.has(p);
            return `<span class="prereq-chip${met ? '' : ' missing'}" data-prereq="${p}">${p}</span>`;
          }).join('');

          let badgeHtml = '';
          if (status === 'completed') badgeHtml = `<span class="status-badge badge-completed">‚úì Done</span>`;
          else if (status === 'available') badgeHtml = `<span class="status-badge badge-available">Available</span>`;
          else badgeHtml = `<span class="status-badge badge-locked">üîí Locked</span>`;

          card.innerHTML = `
            <div class="course-check">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><path d="M20 6 9 17l-5-5"/></svg>
            </div>
            <div class="course-id">${course.id}</div>
            <div class="course-info">
              <div class="course-name">${course.name}</div>
              <div class="course-prereqs">${prereqsHtml}</div>
            </div>
            <div class="course-right">
              <span class="course-hours">${course.hours} hrs${course.group ? ` ¬∑ Group ${course.group}` : ''}</span>
              ${badgeHtml}
            </div>
          `;

          card.addEventListener('click', (e) => {
            if (e.target.closest('.prereq-chip')) return;
            toggleCourse(course.id);
          });

          card.querySelectorAll('.prereq-chip').forEach(chip => {
            chip.addEventListener('click', (e) => {
              e.stopPropagation();
              const pid = chip.dataset.prereq;
              highlighted = highlighted === pid ? null : pid;
              render();
              const el = document.querySelector(`.course-card[data-id="${pid}"]`);
              if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
          });

          body.appendChild(card);
        });

        list.appendChild(section);
      });

      const inactiveChoices = COURSES_RAW.filter(c => c.group && c.id !== choices[c.group]);
      if (inactiveChoices.length && (filterMode === 'all' || filterMode === 'locked')) {
        const section2 = document.createElement('div');
        section2.className = 'level-section';
        section2.innerHTML = `
          <div class="level-header">
            <span class="level-badge">OPT</span>
            <span class="level-title">Not Selected (Choice Alternatives)</span>
            <span class="level-meta">${inactiveChoices.length} courses</span>
            <span class="level-toggle"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg></span>
          </div>
          <div class="level-body"></div>
        `;
        section2.querySelector('.level-header').addEventListener('click', () => section2.classList.toggle('collapsed'));
        const body2 = section2.querySelector('.level-body');

        inactiveChoices.forEach(course => {
          const card = document.createElement('div');
          card.className = 'course-card locked';
          card.style.opacity = '0.4';
          card.innerHTML = `
            <div class="course-check"></div>
            <div class="course-id">${course.id}</div>
            <div class="course-info"><div class="course-name">${course.name}</div></div>
            <div class="course-right">
              <span class="course-hours">${course.hours} hrs ¬∑ Group ${course.group}</span>
              <span class="status-badge badge-not-selected">Not Selected</span>
            </div>
          `;
          body2.appendChild(card);
        });
        list.appendChild(section2);
      }

      if (!list.children.length) {
        list.innerHTML = '<div class="empty-state">No courses match your filter.</div>';
      }
    }

    function toggleCourse(id) {
      const course = COURSES_RAW.find(c => c.id === id);
      if (!course) return;

      if (completed.has(id)) {
        const deps = getAllDependents(id).filter(d => completed.has(d));
        if (deps.length > 0) {
          showModal(
            'Uncheck & Remove Dependencies',
            `Unchecking <strong>${id}</strong> will also uncheck these dependent courses:`,
            deps,
            () => {
              completed.delete(id);
              deps.forEach(d => completed.delete(d));
              save(); render();
              showToast(`Unchecked ${id} and ${deps.length} dependent(s).`, 'error');
            }
          );
        } else {
          completed.delete(id);
          save(); render();
          showToast(`Unchecked ${course.id} ‚Äî ${course.name}`, 'error');
        }
      } else {
        const missing = course.prereqs.filter(p => !completed.has(p));
        if (missing.length > 0) {
          showToast(`Cannot complete ${id}. Missing prereqs: ${missing.join(', ')}`, 'error');
          return;
        }
        completed.add(id);
        save(); render();
        showToast(`Completed ${course.id} ‚Äî ${course.name}`, 'success');
      }
    }

    function showModal(title, msg, items, onConfirm) {
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      overlay.innerHTML = `
        <div class="modal">
          <h3>${title}</h3>
          <p>${msg}</p>
          <ul>${(items || []).map(i => `<li>${i}</li>`).join('')}</ul>
          <div class="modal-actions">
            <button class="btn" id="modalCancel">Cancel</button>
            <button class="btn btn-accent" id="modalConfirm">Confirm</button>
          </div>
        </div>
      `;
      document.body.appendChild(overlay);
      overlay.querySelector('#modalCancel').addEventListener('click', () => overlay.remove());
      overlay.querySelector('#modalConfirm').addEventListener('click', () => { overlay.remove(); onConfirm(); });
      overlay.addEventListener('click', e => { if (e.target === overlay) overlay.remove(); });
    }

    function showToast(msg, type = '') {
      const c = document.getElementById('toast-container');
      const t = document.createElement('div');
      t.className = `toast ${type}`;
      t.textContent = msg;
      c.appendChild(t);
      setTimeout(() => {
        t.style.animation = 'toastOut 0.3s forwards';
        setTimeout(() => t.remove(), 300);
      }, 3000);
    }

    document.querySelectorAll('.choice-opt').forEach(btn => {
      btn.addEventListener('click', () => {
        const group = btn.dataset.group;
        const val = btn.dataset.val;
        if (choices[group] === val) return;

        const oldChoice = choices[group];
        const newChoice = val;

        const affectedDeps = completed.has(oldChoice)
          ? [oldChoice, ...getAllDependents(oldChoice).filter(d => completed.has(d))]
          : [];

        const msg = affectedDeps.length
          ? `Switching from ${oldChoice} to ${newChoice}. This will uncheck: ${affectedDeps.join(', ')}.`
          : `Switch Group ${group} selection from ${oldChoice} to ${newChoice}?`;

        if (affectedDeps.length) {
          showModal(
            `Change Group ${group} Selection`,
            msg,
            affectedDeps,
            () => {
              affectedDeps.forEach(d => completed.delete(d));
              choices[group] = newChoice;
              document.querySelectorAll(`.choice-opt[data-group="${group}"]`).forEach(b =>
                b.classList.toggle('selected', b.dataset.val === newChoice)
              );
              save(); render();
            }
          );
        } else {
          choices[group] = newChoice;
          document.querySelectorAll(`.choice-opt[data-group="${group}"]`).forEach(b =>
            b.classList.toggle('selected', b.dataset.val === newChoice)
          );
          save(); render();
          showToast(`Group ${group}: selected ${newChoice}`, 'success');
        }
      });
    });

    document.getElementById('mark13Btn').addEventListener('click', () => {
      const lvl1to3 = getActiveCourses().filter(c => c.level <= 3);
      const toAdd = topoSort(lvl1to3.map(c => c.id));
      toAdd.forEach(id => completed.add(id));
      save(); render();
      showToast('Levels 1‚Äì3 marked as completed!', 'success');
    });

    document.getElementById('markAllBtn').addEventListener('click', () => {
      showModal('Mark All Completed', 'Mark every active course as completed?', [], () => {
        const all = topoSort(getActiveCourses().map(c => c.id));
        all.forEach(id => completed.add(id));
        save(); render();
        showToast('All courses marked as completed!', 'success');
      });
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      showModal('Reset Progress', 'Clear all completion data?', [], () => {
        completed.clear();
        save(); render();
        showToast('Progress reset.', 'error');
      });
    });

    document.getElementById('themeToggle').addEventListener('click', () => {
      // this is YOUR local override for this page
      const next = document.body.classList.contains("light") ? "dark" : "light";
      applyTheme(next);
      save();
    });

    document.getElementById('searchInput').addEventListener('input', e => {
      searchQ = e.target.value;
      render();
    });

    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        filterMode = tab.dataset.filter;
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        render();
      });
    });

    function topoSort(ids) {
      const map = {};
      ids.forEach(id => {
        const c = COURSES_RAW.find(x => x.id === id);
        map[id] = c ? c.prereqs.filter(p => ids.includes(p)) : [];
      });
      const visited = new Set(), result = [];
      function visit(id) {
        if (visited.has(id)) return;
        visited.add(id);
        (map[id] || []).forEach(visit);
        result.push(id);
      }
      ids.forEach(visit);
      return result;
    }

    // INIT
    load();
    initTheme();
    watchThemeChanges();
    render();

    // if early head script set force-light, apply it now and remove marker
    if (document.documentElement.classList.contains("force-light")) {
      applyTheme("light");
      document.documentElement.classList.remove("force-light");
    }
  </script>
</body>

</html>