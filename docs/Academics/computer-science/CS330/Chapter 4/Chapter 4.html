<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 4: Threads - CS330</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f4f4f4;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            border-radius: 10px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        h2 {
            color: #667eea;
            font-size: 1.8em;
            margin: 35px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        h3 {
            color: #764ba2;
            font-size: 1.4em;
            margin: 25px 0 15px 0;
        }

        /* Thread vs Process Comparison */
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }

        .process-box, .thread-box {
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
        }

        .process-box {
            background: #f0f8ff;
        }

        .thread-box {
            background: #f5f0ff;
        }

        .box-header {
            text-align: center;
            padding: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            color: white;
            border-radius: 5px;
        }

        .process-box .box-header {
            background: #3498db;
        }

        .thread-box .box-header {
            background: #9b59b6;
        }

        .resource-section {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }

        /* Threading Models Visualization */
        .model-container {
            margin: 30px 0;
            padding: 25px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .thread-model {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }

        .user-space, .kernel-space {
            width: 100%;
            max-width: 500px;
            padding: 20px;
            margin: 5px 0;
            border: 2px solid #333;
            text-align: center;
        }

        .user-space {
            background: #e8f4f8;
        }

        .kernel-space {
            background: #ffe8e8;
        }

        .thread-icon {
            display: inline-block;
            width: 40px;
            height: 60px;
            margin: 0 10px;
            background: #3498db;
            border-radius: 5px;
            position: relative;
        }

        .thread-icon::before {
            content: '‚áÖ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
        }

        .kernel-thread {
            background: #e74c3c;
        }

        /* Benefits Grid */
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .benefit-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .benefit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .benefit-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        /* Concurrency vs Parallelism */
        .concurrency-diagram {
            margin: 30px 0;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 10px;
        }

        .execution-timeline {
            display: flex;
            align-items: center;
            margin: 20px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
        }

        .core-label {
            width: 100px;
            font-weight: bold;
            color: #333;
        }

        .timeline {
            flex: 1;
            display: flex;
            height: 40px;
            border: 1px solid #ddd;
        }

        .time-slice {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #ddd;
            font-weight: bold;
            color: white;
        }

        .t1 { background: #3498db; }
        .t2 { background: #e74c3c; }
        .t3 { background: #2ecc71; }
        .t4 { background: #f39c12; }

        /* Code Blocks */
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .code-comment {
            color: #95a5a6;
        }

        .code-keyword {
            color: #3498db;
        }

        .code-function {
            color: #2ecc71;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
        }

        td {
            padding: 12px 15px;
            border: 1px solid #ddd;
        }

        tr:nth-child(even) {
            background: #f8f9ff;
        }

        /* Concept Box */
        .concept-box {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .highlight {
            background: #ffd700;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }

        /* Example Box */
        .example-box {
            background: #e8f8f5;
            border: 2px solid #27ae60;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        /* Warning Box */
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
        }

        /* Exam Section */
        .exam-section {
            background: #fff8dc;
            border: 2px solid #ffd700;
            padding: 25px;
            margin: 30px 0;
            border-radius: 10px;
        }

        .exam-question {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .mcq-options {
            list-style: none;
            margin-top: 15px;
        }

        .mcq-options li {
            background: #f8f9ff;
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 3px solid transparent;
        }

        .correct-answer {
            background: #d4edda !important;
            border-left: 3px solid #28a745 !important;
        }

        /* Image Placeholder */
        .image-placeholder {
            background: #95a5a6;
            color: white;
            padding: 60px 20px;
            text-align: center;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px dashed #7f8c8d;
        }

        /* Thread Library Cards */
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .library-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .library-card h4 {
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
        }

        footer {
            background: #667eea;
            color: white;
            text-align: center;
            padding: 25px;
            margin-top: 40px;
            border-radius: 10px;
        }

        .subsection {
            margin-left: 20px;
            padding-left: 20px;
            border-left: 2px solid #ecf0f1;
        }

        /* Server Architecture Diagram */
        .server-diagram {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 30px 0;
            padding: 30px;
            background: #f0f8ff;
            border-radius: 10px;
        }

        .server-component {
            padding: 20px;
            background: #3498db;
            color: white;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }

        .arrow {
            font-size: 30px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Chapter 4: Threads</h1>
            <p style="font-size: 1.2em;">CS330 - Operating Systems</p>
            <p>Multithreading Models, Benefits, and Implementation</p>
        </header>

        <!-- Section 1: Thread Overview -->
        <section>
            <h2>4.1 Thread Overview</h2>
            
            <div class="concept-box">
                <p>A <span class="highlight">thread</span> is a basic unit of CPU utilization. It is also called a lightweight process. A thread comprises a thread ID, program counter, register set, and stack.</p>
            </div>

            <h3>Thread Components</h3>
            <div class="subsection">
                <h4>Each thread has its own:</h4>
                <ul>
                    <li>Thread ID</li>
                    <li>Program counter</li>
                    <li>Register set</li>
                    <li>Stack space</li>
                </ul>

                <h4>Threads share with other threads:</h4>
                <ul>
                    <li>Code section</li>
                    <li>Data section</li>
                    <li>Operating system resources (open files, signals)</li>
                </ul>
            </div>

            <h3>Process Types</h3>
            <table>
                <tr>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Characteristics</th>
                </tr>
                <tr>
                    <td><strong>Heavyweight Process</strong></td>
                    <td>Traditional process with single thread</td>
                    <td>One thread of control</td>
                </tr>
                <tr>
                    <td><strong>Lightweight Process</strong></td>
                    <td>Another name for thread</td>
                    <td>Basic unit of CPU utilization</td>
                </tr>
                <tr>
                    <td><strong>Multithreaded Process</strong></td>
                    <td>Process with multiple threads</td>
                    <td>Multiple threads share process resources</td>
                </tr>
            </table>

            <div class="image-placeholder">
                <h4>üìä Single vs Multithreaded Process</h4>
                <p>[Insert diagram showing single-threaded vs multithreaded process structure]</p>
            </div>
        </section>

        <!-- Section 2: Thread vs Process -->
        <section>
            <h2>4.2 Single-threaded vs Multithreaded Processes</h2>
            
            <div class="comparison-container">
                <div class="process-box">
                    <div class="box-header">Single-threaded Process</div>
                    <div class="resource-section">
                        <strong>Shared Resources:</strong>
                        <ul>
                            <li>Code</li>
                            <li>Data</li>
                            <li>Files</li>
                        </ul>
                    </div>
                    <div class="resource-section">
                        <strong>Per-Process:</strong>
                        <ul>
                            <li>Registers</li>
                            <li>Stack</li>
                            <li>Program Counter</li>
                        </ul>
                    </div>
                </div>
                
                <div class="thread-box">
                    <div class="box-header">Multithreaded Process</div>
                    <div class="resource-section">
                        <strong>Shared (among threads):</strong>
                        <ul>
                            <li>Code</li>
                            <li>Data</li>
                            <li>Files</li>
                        </ul>
                    </div>
                    <div class="resource-section">
                        <strong>Per-Thread:</strong>
                        <ul>
                            <li>Registers</li>
                            <li>Stack</li>
                            <li>Program Counter</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="warning-box">
                <h4>‚ö†Ô∏è Important:</h4>
                <p>Threads within the same process share memory and resources, which makes communication between threads efficient but requires careful synchronization to avoid race conditions.</p>
            </div>
        </section>

        <!-- Section 3: Benefits of Multithreading -->
        <section>
            <h2>4.3 Benefits of Multithreading</h2>
            
            <div class="benefits-grid">
                <div class="benefit-card">
                    <h4>üì± Responsiveness</h4>
                    <p>Allows a program to continue running even if part is blocked. Example: Web browser can allow user interaction in one thread while loading images in another.</p>
                </div>
                
                <div class="benefit-card">
                    <h4>üîÑ Resource Sharing</h4>
                    <p>Threads share memory and resources of the process they belong to. Easier than shared memory or message passing between processes.</p>
                </div>
                
                <div class="benefit-card">
                    <h4>üí∞ Economy</h4>
                    <p>Thread creation is faster than process creation. Context switching between threads has lower overhead. In Solaris, creating process is 30 times slower than thread.</p>
                </div>
                
                <div class="benefit-card">
                    <h4>‚ö° Scalability</h4>
                    <p>Can utilize multiprocessor architectures. Multiple threads can run in parallel on different CPUs. Single-threaded process can run only on one CPU.</p>
                </div>
            </div>

            <div class="exam-section">
                <h4>üìù Exam Question (CS330):</h4>
                <div class="exam-question">
                    <p><strong>Q:</strong> List the four major benefits of multithreaded programming.</p>
                    <div class="example-box">
                        <p><strong>Answer:</strong></p>
                        <ol>
                            <li><strong>Responsiveness:</strong> May allow continued execution if part of process is blocked</li>
                            <li><strong>Resource Sharing:</strong> Threads share resources of process, easier than shared memory</li>
                            <li><strong>Economy:</strong> Cheaper than process creation, lower overhead for context switching</li>
                            <li><strong>Scalability:</strong> Process can take advantage of multiprocessor architectures</li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Multicore Programming -->
        <section>
            <h2>4.4 Multicore Programming</h2>
            
            <h3>Concurrency vs Parallelism</h3>
            <div class="concurrency-diagram">
                <h4>Single-Core System (Concurrency)</h4>
                <div class="execution-timeline">
                    <div class="core-label">Single Core</div>
                    <div class="timeline">
                        <div class="time-slice t1">T‚ÇÅ</div>
                        <div class="time-slice t2">T‚ÇÇ</div>
                        <div class="time-slice t3">T‚ÇÉ</div>
                        <div class="time-slice t4">T‚ÇÑ</div>
                        <div class="time-slice t1">T‚ÇÅ</div>
                        <div class="time-slice t2">T‚ÇÇ</div>
                        <div class="time-slice t3">T‚ÇÉ</div>
                        <div class="time-slice t4">T‚ÇÑ</div>
                    </div>
                </div>
                <p>Threads are interleaved over time</p>

                <h4>Multi-Core System (Parallelism)</h4>
                <div class="execution-timeline">
                    <div class="core-label">Core 1</div>
                    <div class="timeline">
                        <div class="time-slice t1">T‚ÇÅ</div>
                        <div class="time-slice t3">T‚ÇÉ</div>
                        <div class="time-slice t1">T‚ÇÅ</div>
                        <div class="time-slice t3">T‚ÇÉ</div>
                    </div>
                </div>
                <div class="execution-timeline">
                    <div class="core-label">Core 2</div>
                    <div class="timeline">
                        <div class="time-slice t2">T‚ÇÇ</div>
                        <div class="time-slice t4">T‚ÇÑ</div>
                        <div class="time-slice t2">T‚ÇÇ</div>
                        <div class="time-slice t4">T‚ÇÑ</div>
                    </div>
                </div>
                <p>Threads run simultaneously on different cores</p>
            </div>

            <table>
                <tr>
                    <th>Aspect</th>
                    <th>Concurrency</th>
                    <th>Parallelism</th>
                </tr>
                <tr>
                    <td>Definition</td>
                    <td>Multiple tasks make progress</td>
                    <td>Multiple tasks execute simultaneously</td>
                </tr>
                <tr>
                    <td>Hardware</td>
                    <td>Can work on single core</td>
                    <td>Requires multiple cores</td>
                </tr>
                <tr>
                    <td>Execution</td>
                    <td>Interleaved execution</td>
                    <td>Simultaneous execution</td>
                </tr>
            </table>

            <h3>Types of Parallelism</h3>
            <div class="subsection">
                <h4>Data Parallelism</h4>
                <p>Distributes subsets of the same data across multiple cores, same operation on each.</p>
                <p><strong>Example:</strong> Summing array elements - divide array into chunks, sum each chunk in parallel.</p>

                <h4>Task Parallelism</h4>
                <p>Distributing threads across cores, each thread performing unique operation.</p>
                <p><strong>Example:</strong> Web server - one thread handles requests, another processes data, another updates logs.</p>
            </div>
        </section>

        <!-- Section 5: User and Kernel Threads -->
        <section>
            <h2>4.5 User Threads and Kernel Threads</h2>
            
            <h3>User Threads</h3>
            <div class="concept-box">
                <p>Threads managed by user-level threads library, not in the kernel. Scheduled by the thread library.</p>
            </div>
            
            <table>
                <tr>
                    <th>Advantages</th>
                    <th>Disadvantages</th>
                </tr>
                <tr>
                    <td>
                        <ul>
                            <li>Fast to create and manage</li>
                            <li>No kernel intervention needed</li>
                            <li>Thread switching doesn't require kernel mode</li>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <li>Blocking system call blocks entire process</li>
                            <li>Cannot take advantage of multiprocessing</li>
                            <li>No true parallelism</li>
                        </ul>
                    </td>
                </tr>
            </table>

            <p><strong>Examples:</strong> POSIX Pthreads, Java threads, Win32 threads</p>

            <h3>Kernel Threads</h3>
            <div class="concept-box">
                <p>All thread management done by kernel itself. Kernel does creation, scheduling and management.</p>
            </div>
            
            <table>
                <tr>
                    <th>Advantages</th>
                    <th>Disadvantages</th>
                </tr>
                <tr>
                    <td>
                        <ul>
                            <li>If one thread blocks, kernel can schedule another</li>
                            <li>Can run threads on different processors</li>
                            <li>True parallelism on multiprocessor systems</li>
                        </ul>
                    </td>
                    <td>
                        <ul>
                            <li>Slower to create and manage</li>
                            <li>Requires kernel intervention</li>
                            <li>More overhead for thread operations</li>
                        </ul>
                    </td>
                </tr>
            </table>

            <p><strong>Examples:</strong> Windows, Linux, Mac OS X, iOS, Android</p>

            <div class="exam-section">
                <h4>üìù Practice Question:</h4>
                <div class="exam-question">
                    <p><strong>Q:</strong> One disadvantage of User-Level Threads (ULTs) compared to Kernel-Level Threads (KLTs) is:</p>
                    <ul class="mcq-options">
                        <li>a) Scheduling is application specific</li>
                        <li class="correct-answer">b) When a ULT executes a system call, all threads in the process are blocked</li>
                        <li>c) Thread switching does not require kernel mode privileges</li>
                        <li>d) All of the above</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 6: Multithreading Models -->
        <section>
            <h2>4.6 Multithreading Models</h2>
            
            <h3>1. Many-to-One Model</h3>
            <div class="model-container">
                <div class="thread-model">
                    <div class="user-space">
                        <strong>User Space</strong><br>
                        <span class="thread-icon"></span>
                        <span class="thread-icon"></span>
                        <span class="thread-icon"></span>
                        <span class="thread-icon"></span>
                    </div>
                    <div style="font-size: 30px; color: #333;">‚Üì</div>
                    <div class="kernel-space">
                        <strong>Kernel Space</strong><br>
                        <span class="thread-icon kernel-thread"></span>
                    </div>
                </div>
                <div class="subsection">
                    <h4>Characteristics:</h4>
                    <ul>
                        <li>Many user threads mapped to single kernel thread</li>
                        <li>Thread management done in user space - efficient</li>
                        <li>Entire process blocks if thread makes blocking system call</li>
                        <li>Cannot run in parallel on multiprocessors</li>
                        <li>Few systems currently use this model</li>
                    </ul>
                    <p><strong>Examples:</strong> Solaris Green Threads, GNU Portable Threads</p>
                </div>
            </div>

            <h3>2. One-to-One Model</h3>
            <div class="model-container">
                <div class="thread-model">
                    <div class="user-space">
                        <strong>User Space</strong><br>
                        <span class="thread-icon"></span>
                        <span class="thread-icon"></span>
                        <span class="thread-icon"></span>
                    </div>
                    <div style="font-size: 30px; color: #333;">‚Üì ‚Üì ‚Üì</div>
                    <div class="kernel-space">
                        <strong>Kernel Space</strong><br>
                        <span class="thread-icon kernel-thread"></span>
                        <span class="thread-icon kernel-thread"></span>
                        <span class="thread-icon kernel-thread"></span>
                    </div>
                </div>
                <div class="subsection">
                    <h4>Characteristics:</h4>
                    <ul>
                        <li>Each user thread maps to kernel thread</li>
                        <li>More concurrency - if one blocks, others can run</li>
                        <li>Can run on different CPUs in multiprocessor system</li>
                        <li>Thread management done by kernel - slower</li>
                        <li>Overhead of creating kernel threads</li>
                    </ul>
                    <p><strong>Examples:</strong> Windows, Linux</p>
                </div>
            </div>

            <h3>3. Many-to-Many Model</h3>
            <div class="model-container">
                <div class="thread-model">
                    <div class="user-space">
                        <strong>User Space</strong><br>
                        <span class="thread-icon"></span>
                        <span class="thread-icon"></span>
                        <span class="thread-icon"></span>
                        <span class="thread-icon"></span>
                    </div>
                    <div style="font-size: 30px; color: #333;">‚Üò ‚Üì ‚Üô</div>
                    <div class="kernel-space">
                        <strong>Kernel Space</strong><br>
                        <span class="thread-icon kernel-thread"></span>
                        <span class="thread-icon kernel-thread"></span>
                    </div>
                </div>
                <div class="subsection">
                    <h4>Characteristics:</h4>
                    <ul>
                        <li>Many user threads mapped to smaller or equal kernel threads</li>
                        <li>Allows more user threads than kernel threads</li>
                        <li>Kernel threads run in parallel on multiprocessor</li>
                        <li>If thread blocks, kernel can schedule another</li>
                        <li>Best features of both models</li>
                    </ul>
                    <p><strong>Examples:</strong> Solaris prior to version 9, Windows with ThreadFiber</p>
                </div>
            </div>

            <h3>4. Two-level Model</h3>
            <div class="concept-box">
                <p>Similar to M:M, except it allows a user thread to be bound to kernel thread.</p>
                <p><strong>Examples:</strong> IRIX, HP-UX, Tru64 UNIX, Solaris 8 and earlier</p>
            </div>
        </section>

        <!-- Section 7: Thread Libraries -->
        <section>
            <h2>4.7 Thread Libraries</h2>
            
            <div class="concept-box">
                <p>A <span class="highlight">thread library</span> provides programmer with API for creating and managing threads.</p>
            </div>

            <div class="library-grid">
                <div class="library-card">
                    <h4>POSIX Pthreads</h4>
                    <ul>
                        <li>POSIX standard (IEEE 1003.1c)</li>
                        <li>Specification, not implementation</li>
                        <li>Common in UNIX systems</li>
                        <li>Can be user or kernel level</li>
                    </ul>
                </div>
                
                <div class="library-card">
                    <h4>Java Threads</h4>
                    <ul>
                        <li>Managed by JVM</li>
                        <li>Platform independent</li>
                        <li>Typically mapped to OS threads</li>
                        <li>Built into language</li>
                    </ul>
                </div>
                
                <div class="library-card">
                    <h4>Windows Threads</h4>
                    <ul>
                        <li>Win32/64 API</li>
                        <li>Kernel-level library</li>
                        <li>One-to-one model</li>
                        <li>CreateThread() function</li>
                    </ul>
                </div>
            </div>

            <h3>Pthreads Example</h3>
            <div class="code-block">
<span class="code-comment">// Simple Pthread example in C</span>
#include &lt;pthread.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

<span class="code-keyword">void</span> *<span class="code-function">runner</span>(<span class="code-keyword">void</span> *param) {
    <span class="code-keyword">int</span> *value = (<span class="code-keyword">int</span> *)param;
    printf("Thread: value = %d\n", *value);
    *value = (*value) * 2;
    <span class="code-function">pthread_exit</span>(0);
}

<span class="code-keyword">int</span> <span class="code-function">main</span>() {
    <span class="code-keyword">pthread_t</span> tid;  <span class="code-comment">// Thread identifier</span>
    <span class="code-keyword">pthread_attr_t</span> attr;  <span class="code-comment">// Thread attributes</span>
    <span class="code-keyword">int</span> value = 5;
    
    <span class="code-comment">// Initialize default attributes</span>
    <span class="code-function">pthread_attr_init</span>(&attr);
    
    <span class="code-comment">// Create thread</span>
    <span class="code-function">pthread_create</span>(&tid, &attr, runner, &value);
    
    <span class="code-comment">// Wait for thread to exit</span>
    <span class="code-function">pthread_join</span>(tid, NULL);
    
    printf("Main: value = %d\n", value);
    return 0;
}
            </div>

            <h3>Common Pthread Functions</h3>
            <table>
                <tr>
                    <th>Function</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>pthread_create()</code></td>
                    <td>Create a new thread</td>
                </tr>
                <tr>
                    <td><code>pthread_join()</code></td>
                    <td>Wait for thread to terminate</td>
                </tr>
                <tr>
                    <td><code>pthread_exit()</code></td>
                    <td>Terminate calling thread</td>
                </tr>
                <tr>
                    <td><code>pthread_attr_init()</code></td>
                    <td>Initialize thread attributes</td>
                </tr>
                <tr>
                    <td><code>pthread_self()</code></td>
                    <td>Get calling thread's ID</td>
                </tr>
                <tr>
                    <td><code>pthread_equal()</code></td>
                    <td>Compare two thread IDs</td>
                </tr>
            </table>
        </section>

        <!-- Section 8: Threading Issues -->
        <section>
            <h2>4.8 Threading Issues</h2>
            
            <h3>1. fork() and exec() Semantics</h3>
            <div class="concept-box">
                <p>When a multithreaded process calls fork():</p>
                <ul>
                    <li>Should new process duplicate all threads?</li>
                    <li>Or only the calling thread?</li>
                </ul>
                <p>Different systems handle this differently. exec() typically replaces entire process.</p>
            </div>

            <h3>2. Signal Handling</h3>
            <div class="subsection">
                <p>Where should signal be delivered?</p>
                <ul>
                    <li>To the thread to which signal applies</li>
                    <li>To every thread in process</li>
                    <li>To certain threads in process</li>
                    <li>To specific thread assigned to receive all signals</li>
                </ul>
            </div>

            <h3>3. Thread Cancellation</h3>
            <table>
                <tr>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Issues</th>
                </tr>
                <tr>
                    <td><strong>Asynchronous</strong></td>
                    <td>Terminate target thread immediately</td>
                    <td>Resources may not be freed, data may be inconsistent</td>
                </tr>
                <tr>
                    <td><strong>Deferred</strong></td>
                    <td>Target thread checks flag periodically</td>
                    <td>Safer but requires cooperation</td>
                </tr>
            </table>

            <h3>4. Thread-Local Storage (TLS)</h3>
            <div class="concept-box">
                <p>Allows each thread to have its own copy of data. Useful when you don't have control over thread creation process.</p>
            </div>

            <h3>5. Thread Pools</h3>
            <div class="subsection">
                <h4>Concept:</h4>
                <p>Create number of threads at startup and place them in pool where they await work.</p>
                
                <h4>Advantages:</h4>
                <ul>
                    <li>Usually slightly faster to service request with existing thread</li>
                    <li>Allows bound on number of threads in application</li>
                    <li>Separates task to be performed from thread management</li>
                </ul>
            </div>
        </section>

        <!-- Section 9: Multithreaded Server Architecture -->
        <section>
            <h2>4.9 Multithreaded Server Architecture</h2>
            
            <div class="server-diagram">
                <div class="server-component">Client</div>
                <span class="arrow">‚Üí</span>
                <div class="server-component" style="background: #e74c3c;">Server<br>(Main Thread)</div>
                <span class="arrow">‚Üí</span>
                <div class="server-component" style="background: #2ecc71;">Worker Thread</div>
            </div>

            <div class="concept-box">
                <h4>How it works:</h4>
                <ol>
                    <li>Server creates separate thread that listens for client requests</li>
                    <li>When request arrives, server creates new thread to service request</li>
                    <li>Server resumes listening for additional requests</li>
                    <li>More efficient than creating new process for each request</li>
                </ol>
            </div>

            <div class="example-box">
                <h4>Example: Web Server</h4>
                <ul>
                    <li>Main thread listens on port 80</li>
                    <li>For each HTTP request, spawn worker thread</li>
                    <li>Worker thread handles request and sends response</li>
                    <li>Main thread continues accepting new connections</li>
                </ul>
            </div>
        </section>

        <!-- Section 10: Exam Practice -->
        <section>
            <h2>4.10 Exam-Style Practice Questions</h2>
            
            <div class="exam-section">
                <h3>Multiple Choice Questions</h3>
                
                <div class="exam-question">
                    <p><strong>Q1.</strong> Which is NOT shared by threads?</p>
                    <ul class="mcq-options">
                        <li>a) Program counter</li>
                        <li>b) Stack</li>
                        <li class="correct-answer">c) Both (a) and (b)</li>
                        <li>d) None of the mentioned</li>
                    </ul>
                </div>

                <div class="exam-question">
                    <p><strong>Q2.</strong> A process that has multiple threads of control can do more than one task at a time. This is called:</p>
                    <ul class="mcq-options">
                        <li>a) Multiprogramming</li>
                        <li class="correct-answer">b) Multithreading</li>
                        <li>c) Multiprocessing</li>
                        <li>d) Multitasking</li>
                    </ul>
                </div>

                <div class="exam-question">
                    <p><strong>Q3.</strong> In the Many-to-One threading model, if one thread performs a blocking system call:</p>
                    <ul class="mcq-options">
                        <li>a) Only that thread is blocked</li>
                        <li class="correct-answer">b) The entire process blocks</li>
                        <li>c) Another thread is scheduled</li>
                        <li>d) The kernel switches to another process</li>
                    </ul>
                </div>

                <div class="exam-question">
                    <p><strong>Q4.</strong> Thread creation is:</p>
                    <ul class="mcq-options">
                        <li>a) More expensive than process creation</li>
                        <li class="correct-answer">b) Less expensive than process creation</li>
                        <li>c) Equal in cost to process creation</li>
                        <li>d) Not possible in modern OS</li>
                    </ul>
                </div>

                <h3>Short Answer Questions</h3>
                
                <div class="exam-question">
                    <p><strong>Q5.</strong> Consider this code segment. How many unique processes and threads are created?</p>
                    <div class="code-block">
pid = fork();
if (pid == 0) {  <span class="code-comment">/* child process */</span>
    fork();
    thread_create(...);
}
fork();
                    </div>
                    <div class="example-box">
                        <h4>Answer:</h4>
                        <ul>
                            <li>Initial fork() creates 1 child (2 processes total)</li>
                            <li>Child executes second fork() (3 processes total)</li>
                            <li>2 processes execute thread_create() (2 threads created)</li>
                            <li>All 3 processes execute final fork() (6 processes total)</li>
                            <li><strong>Total: 6 processes, 8 threads (6 main + 2 created)</strong></li>
                        </ul>
                    </div>
                </div>

                <div class="exam-question">
                    <p><strong>Q6.</strong> In a multiprocessor system with many-to-many threading model, discuss performance when:</p>
                    <p>a) Number of kernel threads < number of processors</p>
                    <p>b) Number of kernel threads = number of processors</p>
                    <div class="example-box">
                        <h4>Answer:</h4>
                        <p><strong>a)</strong> Some processors remain idle since scheduler maps only kernel threads to processors, not user threads.</p>
                        <p><strong>b)</strong> All processors can be utilized simultaneously. However, if kernel thread blocks (page fault, system call), corresponding processor becomes idle.</p>
                    </div>
                </div>

                <div class="exam-question">
                    <p><strong>Q7.</strong> What is the difference between concurrency and parallelism?</p>
                    <div class="example-box">
                        <h4>Answer:</h4>
                        <ul>
                            <li><strong>Concurrency:</strong> Multiple tasks making progress, possibly interleaved. Can occur on single processor through time-slicing.</li>
                            <li><strong>Parallelism:</strong> Multiple tasks executing simultaneously. Requires multiple processors/cores.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 11: Key Terms -->
        <section>
            <h2>4.11 Key Terms and Definitions</h2>
            
            <table>
                <tr>
                    <th>Term</th>
                    <th>Definition</th>
                </tr>
                <tr>
                    <td><strong>Thread</strong></td>
                    <td>Basic unit of CPU utilization; lightweight process</td>
                </tr>
                <tr>
                    <td><strong>Multithreading</strong></td>
                    <td>Ability of OS to support multiple threads in single process</td>
                </tr>
                <tr>
                    <td><strong>User Thread</strong></td>
                    <td>Thread managed by user-level library without kernel support</td>
                </tr>
                <tr>
                    <td><strong>Kernel Thread</strong></td>
                    <td>Thread managed directly by operating system kernel</td>
                </tr>
                <tr>
                    <td><strong>Thread Pool</strong></td>
                    <td>Collection of pre-created threads awaiting work</td>
                </tr>
                <tr>
                    <td><strong>TLS</strong></td>
                    <td>Thread-Local Storage - per-thread data storage</td>
                </tr>
                <tr>
                    <td><strong>pthread</strong></td>
                    <td>POSIX thread library specification</td>
                </tr>
                <tr>
                    <td><strong>Concurrency</strong></td>
                    <td>Multiple tasks making progress (possibly interleaved)</td>
                </tr>
                <tr>
                    <td><strong>Parallelism</strong></td>
                    <td>Multiple tasks executing simultaneously</td>
                </tr>
                <tr>
                    <td><strong>Race Condition</strong></td>
                    <td>When outcome depends on timing of uncontrolled events</td>
                </tr>
            </table>
        </section>

        <!-- Image Placeholders -->
        <section>
            <h2>4.12 Diagrams from Slides</h2>
            
            <div class="image-placeholder">
                <h4>üìä Single vs Multithreaded Process</h4>
                <p>[Insert diagram from Chapter_4.pdf page 6]</p>
            </div>

            <div class="image-placeholder">
                <h4>üìä User and Kernel Threads</h4>
                <p>[Insert diagram showing user/kernel space separation]</p>
            </div>

            <div class="image-placeholder">
                <h4>üìä Multithreaded Server Architecture</h4>
                <p>[Insert server architecture diagram from slides]</p>
            </div>

            <div class="image-placeholder">
                <h4>üìä Threading Models Comparison</h4>
                <p>[Insert many-to-one, one-to-one, many-to-many models]</p>
            </div>

            <div class="warning-box">
                <p><strong>Note:</strong> Please provide the actual diagrams from your Chapter_4.pdf slides to replace these placeholders.</p>
            </div>
        </section>

        <footer>
            <p>CS330 - Operating Systems</p>
            <p>Chapter 4: Threads</p>
            <p><strong>Created by: Shoug Alomran</strong></p>
            <p>Prince Sultan University</p>
        </footer>
    </div>
</body>
</html>