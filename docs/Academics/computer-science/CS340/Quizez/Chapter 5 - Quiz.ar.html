<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS340 - Chapter 5: Basic SQL Exam</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            margin-top: 20px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #4ade80;
            width: 0%;
            transition: width 0.3s ease;
        }

        .content {
            padding: 40px;
        }

        .question-container {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            border-radius: 8px;
            display: none;
        }

        .question-container.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
        }

        .question-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }

        .badge.past-exam {
            background: #f59e0b;
        }

        .badge.generated {
            background: #06b6d4;
        }

        .question-text {
            font-size: 1.05em;
            margin-bottom: 20px;
            line-height: 1.6;
            color: #555;
            white-space: pre-wrap;
        }

        .option {
            margin: 12px 0;
            padding: 15px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: flex-start;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option input[type="radio"],
        .option input[type="checkbox"] {
            margin-right: 12px;
            margin-top: 3px;
            cursor: pointer;
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .buttons-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 12px 24px;
            font-size: 1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-submit-all {
            background: #667eea;
            color: white;
            margin-top: 30px;
            width: 100%;
        }

        .btn-submit-all:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-submit-all:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-next {
            background: #10b981;
            color: white;
        }

        .btn-next:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-prev {
            background: #6b7280;
            color: white;
        }

        .btn-prev:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
        }

        .question-counter {
            font-weight: 600;
            color: #667eea;
        }

        .results-container {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .results-container.show {
            display: block;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0 auto 30px;
            font-size: 3em;
            font-weight: bold;
        }

        .score-circle .percentage {
            font-size: 2.5em;
        }

        .score-circle .label {
            font-size: 0.5em;
            margin-top: 5px;
        }

        .results-details {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: left;
        }

        .results-details p {
            font-size: 1.1em;
            margin: 10px 0;
        }

        .btn-restart {
            background: #667eea;
            color: white;
            margin-top: 20px;
        }

        .btn-restart:hover {
            background: #5568d3;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid #e5e7eb;
        }

        .review-question {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .review-title {
            font-weight: 600;
            font-size: 1.05em;
            margin-bottom: 10px;
        }

        .your-answer {
            background: white;
            padding: 12px;
            border-left: 3px solid #3b82f6;
            margin: 10px 0;
            font-size: 0.95em;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }

        .info-box {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            color: #1e40af;
            font-size: 0.95em;
        }

        .code-block {
            background: #1f2937;
            color: #f3f4f6;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 10px 0;
            line-height: 1.5;
        }

        .table-question {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9em;
        }

        .table-question td, .table-question th {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        .table-question th {
            background: #667eea;
            color: white;
        }

        .review-section {
            margin-top: 40px;
            border-top: 3px solid #e5e7eb;
            padding-top: 30px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .question-container {
                padding: 15px;
            }

            .buttons-container {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .question-header {
                flex-direction: column;
            }

            .badge {
                margin-left: 0;
                margin-top: 10px;
                display: block;
                width: fit-content;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíæ Chapter 5: Basic SQL</h1>
            <p>CS340 - Introduction to Database Systems</p>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>

        <div class="content">
            <div id="examContent"></div>
            <div class="results-container" id="resultsContainer">
                <h2>Exam Results üéâ</h2>
                <div class="score-circle">
                    <span class="percentage" id="scorePercentage">0%</span>
                    <span class="label">Score</span>
                </div>
                <div class="results-details">
                    <p><strong>Total Questions:</strong> <span id="totalQuestions">0</span></p>
                    <p><strong>Correct Answers:</strong> <span id="correctAnswers">0</span></p>
                    <p><strong>Incorrect Answers:</strong> <span id="incorrectAnswers">0</span></p>
                    <p id="resultMessage"></p>
                </div>

                <div class="review-section" id="reviewSection"></div>

                <button class="btn-restart" onclick="location.reload()">Take Exam Again</button>
            </div>

            <div class="navigation" id="navigation" style="display: none;">
                <button class="btn-prev" onclick="previousQuestion()">‚Üê Previous</button>
                <span class="question-counter">Question <span id="currentQuestion">1</span> of <span id="totalQuestionsNav">0</span></span>
                <button class="btn-next" onclick="nextQuestion()" id="nextBtn">Next ‚Üí</button>
            </div>
        </div>

        <button class="btn-submit-all" id="submitAllBtn" onclick="submitAllAnswers()">Submit Exam</button>

        <div class="footer">
            <p><strong>Prepared by: Shoug Alomran</strong></p>
            <p>CS340 - Introduction to Database Systems</p>
        </div>
    </div>

    <script>
        const questions = [
            {
                type: 'mcq',
                question: 'What does the SELECT statement do in SQL?',
                options: [
                    'Creates a new table in the database',
                    'Retrieves data from one or more tables',
                    'Modifies existing data in a table',
                    'Deletes rows from a table'
                ],
                correct: 1,
                explanation: 'The SELECT statement is used to retrieve (query) data from a database. It allows you to specify which columns and rows you want to fetch from one or more tables.',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'In SQL, which keyword removes duplicate rows from query results?',
                options: [
                    'ALL',
                    'DISTINCT',
                    'UNIQUE',
                    'REMOVE'
                ],
                correct: 1,
                explanation: 'The DISTINCT keyword eliminates duplicate tuples from the result set. By default, SELECT returns all rows including duplicates (SELECT ALL is implicit).',
                pastExam: true
            },
            {
                type: 'mcq',
                question: 'Which SQL clause is used to filter rows based on conditions?',
                options: [
                    'SELECT',
                    'FROM',
                    'WHERE',
                    'ORDER BY'
                ],
                correct: 2,
                explanation: 'The WHERE clause specifies conditions that rows must satisfy to be included in the result set. It performs selection (restriction) of tuples based on predicates.',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'What is the correct syntax for a basic SELECT statement?',
                options: [
                    'SELECT * WHERE FROM table;',
                    'SELECT * FROM table WHERE condition;',
                    'FROM table SELECT * WHERE condition;',
                    'SELECT FROM table * WHERE condition;'
                ],
                correct: 1,
                explanation: 'The correct syntax is: SELECT [columns] FROM [table] WHERE [condition]. The FROM clause specifies the table(s), WHERE filters rows, and SELECT specifies which columns to return.',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'Which of the following SQL statements would retrieve all employees with a salary greater than 50000?',
                options: [
                    'SELECT * FROM EMPLOYEE WHERE salary < 50000;',
                    'SELECT * FROM EMPLOYEE WHERE salary > 50000;',
                    'SELECT * FROM EMPLOYEE HAVING salary > 50000;',
                    'SELECT * FROM EMPLOYEE WHERE salary = 50000;'
                ],
                correct: 1,
                explanation: 'The > operator is used for "greater than". The WHERE clause is for filtering rows. HAVING is used after GROUP BY for aggregate conditions.',
                pastExam: true
            },
            {
                type: 'mcq',
                question: 'Which SQL command is used to insert new rows into a table?',
                options: [
                    'CREATE',
                    'UPDATE',
                    'INSERT',
                    'ADD'
                ],
                correct: 2,
                explanation: 'The INSERT statement adds new records/tuples to a table. Syntax: INSERT INTO table VALUES (...) or INSERT INTO table (columns) VALUES (...).',
                pastExam: true
            },
            {
                type: 'mcq',
                question: 'What does the UPDATE statement do?',
                options: [
                    'Deletes rows from a table',
                    'Modifies existing data in a table',
                    'Adds new rows to a table',
                    'Recreates the table structure'
                ],
                correct: 1,
                explanation: 'The UPDATE statement modifies existing data in one or more columns of existing rows. Syntax: UPDATE table SET column=value WHERE condition;',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'Which SQL statement removes all rows from a table permanently?',
                options: [
                    'DROP TABLE;',
                    'DELETE FROM table;',
                    'TRUNCATE TABLE;',
                    'REMOVE FROM table;'
                ],
                correct: 2,
                explanation: 'DELETE FROM removes rows. DROP TABLE removes the entire table. TRUNCATE removes all data but is faster. DELETE is more commonly used for removing specific or all rows.',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'What is the purpose of the ORDER BY clause?',
                options: [
                    'Filter rows based on conditions',
                    'Sort the result set by one or more columns',
                    'Group rows by common values',
                    'Join multiple tables'
                ],
                correct: 1,
                explanation: 'ORDER BY sorts the result set in ascending (ASC) or descending (DESC) order based on specified column(s). Default is ascending.',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'In SQL, what is the difference between COUNT(*) and COUNT(column_name)?',
                options: [
                    'They are identical and can be used interchangeably',
                    'COUNT(*) counts all rows including NULL values; COUNT(column) counts non-NULL values in that column',
                    'COUNT(*) is invalid syntax',
                    'COUNT(*) is slower than COUNT(column)'
                ],
                correct: 1,
                explanation: 'COUNT(*) counts all rows in a result set, including those with NULL values. COUNT(column) counts only non-NULL values in that specific column.',
                pastExam: true
            },
            {
                type: 'truefalse',
                question: 'In SQL, the WHERE clause can use aggregate functions like COUNT() or SUM().',
                correct: false,
                explanation: 'FALSE. The WHERE clause filters individual rows before aggregation. Aggregate conditions are applied AFTER grouping using the HAVING clause, not WHERE.',
                pastExam: true
            },
            {
                type: 'truefalse',
                question: 'SQL is a declarative language, meaning you specify WHAT you want, not HOW to get it.',
                correct: true,
                explanation: 'TRUE. SQL is declarative - you state the desired result without specifying the algorithm to retrieve it. The DBMS determines the execution plan.',
                pastExam: false
            },
            {
                type: 'truefalse',
                question: 'The ORDER BY clause must appear before the WHERE clause in a SELECT statement.',
                correct: false,
                explanation: 'FALSE. The correct order is: SELECT ... FROM ... WHERE ... ORDER BY. WHERE comes before ORDER BY in SQL syntax.',
                pastExam: true
            },
            {
                type: 'truefalse',
                question: 'A JOIN operation in SQL combines rows from two or more tables based on a related column.',
                correct: true,
                explanation: 'TRUE. JOINs combine data from multiple tables using a join condition (usually matching primary and foreign keys).',
                pastExam: false
            },
            {
                type: 'shortanswer',
                question: 'Explain the difference between the DELETE statement and the TRUNCATE statement. When would you use each?',
                keywords: ['delete', 'truncate', 'rows', 'remove', 'where', 'condition', 'faster', 'identity', 'log', 'recover'],
                modelAnswer: 'DELETE:\n- Removes rows one by one\n- Can use WHERE clause for conditional deletion\n- Slower for large datasets\n- Can be rolled back (if in transaction)\n- Logs each deleted row\n\nTRUNCATE:\n- Removes all rows at once\n- Cannot use WHERE clause\n- Much faster\n- Uses minimal transaction log space\n- Resets identity seed (if auto-increment)\n\nUse DELETE when you need to delete specific rows or preserve identity values.\nUse TRUNCATE when you need to empty an entire table quickly.',
                explanation: 'Both remove data but work differently - DELETE is row-by-row and flexible; TRUNCATE is bulk and fast.',
                pastExam: true
            },
            {
                type: 'shortanswer',
                question: 'What is the difference between INNER JOIN, LEFT JOIN, and RIGHT JOIN? Provide a brief explanation of when to use each.',
                keywords: ['inner', 'left', 'right', 'join', 'match', 'matching', 'unmatched', 'null', 'all rows', 'left table', 'right table'],
                modelAnswer: 'INNER JOIN:\n- Returns only rows where there is a match in BOTH tables\n- Excludes unmatched rows\n- Use when you need only matching records\n\nLEFT JOIN (LEFT OUTER JOIN):\n- Returns ALL rows from left table\n- Includes matching rows from right table\n- Unmatched right rows shown as NULL\n- Use when you want all records from the left table\n\nRIGHT JOIN (RIGHT OUTER JOIN):\n- Returns ALL rows from right table\n- Includes matching rows from left table\n- Unmatched left rows shown as NULL\n- Use when you want all records from the right table\n\nExample: LEFT JOIN keeps all employees even if not assigned to projects.',
                explanation: 'JOINs determine which rows are preserved when combining tables.',
                pastExam: true
            },
            {
                type: 'shortanswer',
                question: 'Explain what the GROUP BY clause does and why it is used with aggregate functions.',
                keywords: ['group', 'grouping', 'aggregate', 'summary', 'categories', 'division', 'having', 'sum', 'count', 'average'],
                modelAnswer: 'GROUP BY groups rows with identical values in specified column(s).\n\nPurpose:\n- Divide data into meaningful categories\n- Apply aggregate functions (COUNT, SUM, AVG, MAX, MIN) to each group\n- Generate summary reports\n\nExample: GROUP BY department calculates total salary per department.\n\nKey points:\n- Non-grouped columns in SELECT must use aggregate functions\n- Filters applied after grouping use HAVING (not WHERE)\n- NULL values form their own group',
                explanation: 'GROUP BY enables aggregate analysis at category level rather than row level.',
                pastExam: false
            },
            {
                type: 'problem',
                question: 'Write a SQL query for this requirement: From the EMPLOYEE table, retrieve the employee ID, name, and salary for all employees in the IT department with salary greater than 60000. Order the results by salary in descending order.',
                keywords: ['select', 'employee', 'id', 'name', 'salary', 'from', 'where', 'department', 'it', 'greater than', '60000', 'order by', 'desc'],
                modelAnswer: 'SELECT EmployeeID, Name, Salary\nFROM EMPLOYEE\nWHERE Department = \'IT\' AND Salary > 60000\nORDER BY Salary DESC;',
                explanation: 'The query uses SELECT for columns, FROM for the table, WHERE for filtering conditions (both department and salary), and ORDER BY DESC for descending salary order.',
                pastExam: false
            },
            {
                type: 'problem',
                question: 'Write a SQL query to find the total number of employees in each department, showing department name and employee count. Only include departments with more than 5 employees.',
                keywords: ['select', 'count', 'from', 'employee', 'join', 'department', 'group by', 'having', 'department', 'count', 'greater than', '5'],
                modelAnswer: 'SELECT d.DepartmentName, COUNT(e.EmployeeID) AS EmployeeCount\nFROM DEPARTMENT d\nLEFT JOIN EMPLOYEE e ON d.DepartmentID = e.DepartmentID\nGROUP BY d.DepartmentName\nHAVING COUNT(e.EmployeeID) > 5;',
                explanation: 'Uses COUNT(*) with GROUP BY for aggregation, HAVING for filtering groups, and JOIN to connect department and employee tables.',
                pastExam: true
            },
            {
                type: 'problem',
                question: 'Write a SQL query to retrieve all customers who placed at least one order with a total amount exceeding $500.',
                keywords: ['select', 'customer', 'from', 'where', 'order', 'amount', 'greater than', '500', 'join', 'distinct', 'having'],
                modelAnswer: 'SELECT DISTINCT c.CustomerID, c.CustomerName\nFROM CUSTOMER c\nJOIN ORDER o ON c.CustomerID = o.CustomerID\nWHERE o.OrderAmount > 500;',
                explanation: 'Uses DISTINCT to avoid duplicates when a customer has multiple qualifying orders. WHERE filters by order amount. JOIN connects customer and order tables.',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'What does a NULL value represent in SQL?',
                options: [
                    'A zero value',
                    'An empty string',
                    'Unknown, missing, or inapplicable data',
                    'A false boolean value'
                ],
                correct: 2,
                explanation: 'NULL represents data that is unknown, missing, unavailable, or not applicable. It is NOT the same as zero, empty string, or false. NULL comparisons use IS NULL or IS NOT NULL.',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'In SQL, how do you compare values with NULL?',
                options: [
                    'column = NULL',
                    'column <> NULL',
                    'column IS NULL',
                    'column EQUALS NULL'
                ],
                correct: 2,
                explanation: 'Use IS NULL or IS NOT NULL to check for NULL values. The = and <> operators don\'t work with NULL because NULL comparisons always return unknown, not true or false.',
                pastExam: true
            },
            {
                type: 'mcq',
                question: 'Which aggregate function returns the highest value in a column?',
                options: [
                    'HIGH()',
                    'MAXIMUM()',
                    'MAX()',
                    'LARGEST()'
                ],
                correct: 2,
                explanation: 'The MAX() function returns the maximum/highest value. Similarly, MIN() returns the minimum/lowest value in a column.',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'What does the LIKE operator do in SQL?',
                options: [
                    'Checks if two values are equal',
                    'Performs pattern matching in text searches',
                    'Joins multiple tables',
                    'Sorts data alphabetically'
                ],
                correct: 1,
                explanation: 'LIKE is used for pattern matching. It uses wildcards: % (zero or more characters) and _ (single character). Example: WHERE name LIKE \'A%\' finds names starting with A.',
                pastExam: false
            }
        ];

        let currentQuestionIndex = 0;
        let answers = [];
        let submitted = false;

        function initExam() {
            document.getElementById('totalQuestionsNav').textContent = questions.length;
            answers = new Array(questions.length).fill(null);
            document.getElementById('navigation').style.display = 'flex';
            renderQuestion();
        }

        function renderQuestion() {
            const examContent = document.getElementById('examContent');
            examContent.innerHTML = '';
            
            const q = questions[currentQuestionIndex];
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-container active';

            let badgeHtml = '';
            if (q.pastExam) {
                badgeHtml = `<span class="badge past-exam">üìã Past Exam</span>`;
            } else {
                badgeHtml = `<span class="badge generated">‚ú® Generated</span>`;
            }
            
            let questionHTML = `
                <div class="question-header">
                    <span class="question-title">Question ${currentQuestionIndex + 1}/${questions.length}</span>
                    ${badgeHtml}
                </div>
                <div class="question-text">${q.question}</div>
            `;

            if (q.type === 'mcq') {
                questionHTML += '<div>';
                q.options.forEach((option, idx) => {
                    const isSelected = answers[currentQuestionIndex] === idx;
                    
                    let className = 'option';
                    if (isSelected) className += ' selected';
                    
                    questionHTML += `
                        <label class="${className}">
                            <input type="radio" name="answer" value="${idx}" 
                                ${isSelected ? 'checked' : ''}
                                onchange="selectAnswer(${idx})">
                            <span>${option}</span>
                        </label>
                    `;
                });
                questionHTML += '</div>';
            } else if (q.type === 'truefalse') {
                const selected = answers[currentQuestionIndex];
                questionHTML += `
                    <div>
                        <label class="option ${selected === true ? 'selected' : ''}">
                            <input type="radio" name="answer" value="true" 
                                ${selected === true ? 'checked' : ''}
                                onchange="selectAnswer(true)">
                            <span>True</span>
                        </label>
                        <label class="option ${selected === false ? 'selected' : ''}">
                            <input type="radio" name="answer" value="false" 
                                ${selected === false ? 'checked' : ''}
                                onchange="selectAnswer(false)">
                            <span>False</span>
                        </label>
                    </div>
                `;
            } else if (q.type === 'shortanswer' || q.type === 'problem') {
                const answer = answers[currentQuestionIndex] || '';
                questionHTML += `
                    <textarea id="answerText" 
                        onchange="selectAnswer(this.value)"
                        onkeyup="selectAnswer(this.value)">${answer}</textarea>
                `;
            }

            questionDiv.innerHTML = questionHTML;
            examContent.appendChild(questionDiv);
            updateProgress();
        }

        function selectAnswer(answer) {
            answers[currentQuestionIndex] = answer;
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
                document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
                window.scrollTo(0, 0);
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
                document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
                window.scrollTo(0, 0);
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.querySelector('.progress-fill').style.width = progress + '%';
        }

        function submitAllAnswers() {
            submitted = true;
            document.getElementById('submitAllBtn').style.display = 'none';
            document.getElementById('navigation').style.display = 'none';
            showResults();
        }

        function gradeWrittenAnswer(answer, keywords) {
            const answerLower = (answer || '').toLowerCase();
            const matchedKeywords = keywords.filter(kw => 
                answerLower.includes(kw.toLowerCase())
            );
            const matchPercentage = (matchedKeywords.length / keywords.length) * 100;
            return {
                matched: matchedKeywords,
                total: keywords.length,
                percentage: matchPercentage
            };
        }

        function showResults() {
            let correctCount = 0;
            const results = [];

            answers.forEach((answer, idx) => {
                const q = questions[idx];
                if (q.type === 'mcq' || q.type === 'truefalse') {
                    if (answer === q.correct) {
                        correctCount++;
                        results.push({
                            questionIdx: idx,
                            isCorrect: true,
                            type: q.type
                        });
                    } else {
                        results.push({
                            questionIdx: idx,
                            isCorrect: false,
                            type: q.type,
                            userAnswer: answer,
                            correctAnswer: q.correct
                        });
                    }
                } else {
                    const grading = gradeWrittenAnswer(answer, q.keywords);
                    const isPassing = grading.percentage >= 60;
                    if (isPassing) correctCount++;
                    
                    results.push({
                        questionIdx: idx,
                        type: q.type,
                        grading: grading,
                        userAnswer: answer
                    });
                }
            });

            const percentage = Math.round((correctCount / questions.length) * 100);
            document.getElementById('scorePercentage').textContent = percentage + '%';
            document.getElementById('totalQuestions').textContent = questions.length;
            document.getElementById('correctAnswers').textContent = correctCount;
            document.getElementById('incorrectAnswers').textContent = questions.length - correctCount;

            let message = '';
            if (percentage === 100) {
                message = 'Perfect score! You have mastered Basic SQL! üéØ';
            } else if (percentage >= 80) {
                message = 'Excellent work! You have a strong understanding of SQL fundamentals. üåü';
            } else if (percentage >= 60) {
                message = 'Good job! Review the concepts you missed to solidify your understanding. üìö';
            } else {
                message = 'Keep studying! Focus on SQL syntax and continue practicing. üí™';
            }

            document.getElementById('resultMessage').textContent = message;

            generateReview(results);

            document.getElementById('examContent').innerHTML = '';
            document.getElementById('resultsContainer').classList.add('show');
            window.scrollTo(0, 0);
        }

        function generateReview(results) {
            const reviewSection = document.getElementById('reviewSection');
            reviewSection.innerHTML = '<h3 style="margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">Detailed Review</h3>';

            results.forEach((result, idx) => {
                const q = questions[result.questionIdx];
                const reviewDiv = document.createElement('div');
                reviewDiv.className = 'review-question';

                let reviewHTML = `
                    <div class="review-title">Question ${result.questionIdx + 1}: ${q.type === 'mcq' ? 'Multiple Choice' : q.type === 'truefalse' ? 'True/False' : 'SQL Query'}</div>
                    <div style="margin: 10px 0; color: #666; font-size: 0.95em; white-space: pre-wrap;">${q.question}</div>
                `;

                if (q.type === 'mcq' || q.type === 'truefalse') {
                    if (result.isCorrect) {
                        reviewHTML += `<div style="color: #10b981; font-weight: 600;">‚úì Correct</div>`;
                    } else {
                        const userAnswerText = q.type === 'mcq' ? q.options[result.userAnswer] : (result.userAnswer ? 'True' : 'False');
                        const correctAnswerText = q.type === 'mcq' ? q.options[result.correctAnswer] : (result.correctAnswer ? 'True' : 'False');
                        reviewHTML += `
                            <div style="color: #ef4444; font-weight: 600;">‚úó Incorrect</div>
                            <div class="your-answer"><strong>Your answer:</strong> ${userAnswerText}</div>
                            <div class="your-answer"><strong>Correct answer:</strong> ${correctAnswerText}</div>
                        `;
                    }
                } else {
                    const grading = result.grading;
                    const isPassing = grading.percentage >= 60;
                    reviewHTML += `
                        <div style="color: ${isPassing ? '#10b981' : '#ef4444'}; font-weight: 600;">
                            ${isPassing ? '‚úì' : '‚úó'} Score: ${Math.round(grading.percentage)}% (${grading.matched.length}/${grading.total} key concepts)
                        </div>
                        <div class="your-answer"><strong>Your answer:</strong> ${result.userAnswer}</div>
                        <div style="margin-top: 10px; padding: 10px; background: rgba(251, 191, 36, 0.1); border-left: 3px solid #fbbf24; font-size: 0.9em;">
                            <strong>Key concepts found:</strong> ${grading.matched.length > 0 ? grading.matched.join(', ') : 'None detected'}
                        </div>
                        <div style="margin-top: 10px; padding: 10px; background: rgba(59, 130, 246, 0.1); border-left: 3px solid #3b82f6; font-size: 0.9em;">
                            <strong>Expected key concepts:</strong> ${q.keywords.join(', ')}
                        </div>
                    `;
                }

                reviewHTML += `
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                        <div style="font-size: 0.95em; line-height: 1.6;"><strong>Explanation:</strong> ${q.explanation}</div>
                    </div>
                `;

                if (q.type === 'shortanswer' || q.type === 'problem') {
                    reviewHTML += `
                        <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.05); border-left: 3px solid #667eea; font-family: 'Courier New', monospace; font-size: 0.9em; white-space: pre-wrap; line-height: 1.6;">
                            <strong>Model answer:</strong>\n${q.modelAnswer}
                        </div>
                    `;
                }

                reviewDiv.innerHTML = reviewHTML;
                reviewSection.appendChild(reviewDiv);
            });
        }

        window.addEventListener('load', initExam);
    </script>
</body>
</html>