<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS340 - Chapter 4: Relational Model Exam</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            margin-top: 20px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #4ade80;
            width: 0%;
            transition: width 0.3s ease;
        }

        .content {
            padding: 40px;
        }

        .question-container {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            border-radius: 8px;
            display: none;
        }

        .question-container.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
        }

        .question-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }

        .badge.past-exam {
            background: #f59e0b;
        }

        .badge.generated {
            background: #06b6d4;
        }

        .question-text {
            font-size: 1.05em;
            margin-bottom: 20px;
            line-height: 1.6;
            color: #555;
            white-space: pre-wrap;
        }

        .option {
            margin: 12px 0;
            padding: 15px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option input[type="radio"],
        .option input[type="checkbox"] {
            margin-right: 12px;
            cursor: pointer;
            width: 18px;
            height: 18px;
        }

        .option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 0.95em;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #ecfdf5;
            border: 2px solid #10b981;
            color: #047857;
        }

        .feedback.incorrect {
            background: #fef2f2;
            border: 2px solid #ef4444;
            color: #991b1b;
        }

        .feedback-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.05em;
        }

        .explanation {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid currentColor;
            opacity: 0.9;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .model-answer {
            margin-top: 15px;
            padding: 12px;
            background: rgba(0,0,0,0.05);
            border-left: 3px solid currentColor;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
            line-height: 1.6;
        }

        .buttons-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 12px 24px;
            font-size: 1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-submit-all {
            background: #667eea;
            color: white;
            margin-top: 30px;
            width: 100%;
        }

        .btn-submit-all:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-submit-all:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-next {
            background: #10b981;
            color: white;
        }

        .btn-next:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-prev {
            background: #6b7280;
            color: white;
        }

        .btn-prev:hover {
            background: #4b5563;
            transform: translateY(-2px);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
        }

        .question-counter {
            font-weight: 600;
            color: #667eea;
        }

        .results-container {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .results-container.show {
            display: block;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0 auto 30px;
            font-size: 3em;
            font-weight: bold;
        }

        .score-circle .percentage {
            font-size: 2.5em;
        }

        .score-circle .label {
            font-size: 0.5em;
            margin-top: 5px;
        }

        .results-details {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: left;
        }

        .results-details p {
            font-size: 1.1em;
            margin: 10px 0;
        }

        .btn-restart {
            background: #667eea;
            color: white;
            margin-top: 20px;
        }

        .btn-restart:hover {
            background: #5568d3;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid #e5e7eb;
        }

        .keywords-found {
            margin-top: 10px;
            padding: 10px;
            background: rgba(251, 191, 36, 0.1);
            border-left: 3px solid #fbbf24;
            font-size: 0.9em;
        }

        .keyword-match {
            background: #fbbf24;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }

        .review-section {
            margin-top: 40px;
            border-top: 3px solid #e5e7eb;
            padding-top: 30px;
        }

        .review-question {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .review-title {
            font-weight: 600;
            font-size: 1.05em;
            margin-bottom: 10px;
        }

        .your-answer {
            background: white;
            padding: 12px;
            border-left: 3px solid #3b82f6;
            margin: 10px 0;
            font-size: 0.95em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .question-container {
                padding: 15px;
            }

            .buttons-container {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .badge {
                margin-left: 0;
                margin-top: 10px;
                display: block;
                width: fit-content;
            }

            .question-header {
                flex-direction: column;
            }
        }
    </style>
  <script src="/javascripts/standalone-theme.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Chapter 4: Relational Model</h1>
            <p>CS340 - Introduction to Database Systems</p>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>

        <div class="content">
            <div id="examContent"></div>
            <div class="results-container" id="resultsContainer">
                <h2>Exam Results üéâ</h2>
                <div class="score-circle">
                    <span class="percentage" id="scorePercentage">0%</span>
                    <span class="label">Score</span>
                </div>
                <div class="results-details">
                    <p><strong>Total Questions:</strong> <span id="totalQuestions">0</span></p>
                    <p><strong>Correct Answers:</strong> <span id="correctAnswers">0</span></p>
                    <p><strong>Incorrect Answers:</strong> <span id="incorrectAnswers">0</span></p>
                    <p id="resultMessage"></p>
                </div>

                <div class="review-section" id="reviewSection"></div>

                <button class="btn-restart" onclick="location.reload()">Take Exam Again</button>
            </div>

            <div class="navigation" id="navigation" style="display: none;">
                <button class="btn-prev" onclick="previousQuestion()">‚Üê Previous</button>
                <span class="question-counter">Question <span id="currentQuestion">1</span> of <span id="totalQuestionsNav">0</span></span>
                <button class="btn-next" onclick="nextQuestion()" id="nextBtn">Next ‚Üí</button>
            </div>
        </div>

        <button class="btn-submit-all" id="submitAllBtn" onclick="submitAllAnswers()">Submit Exam</button>

        <div class="footer">
            <p><strong>Prepared by: Shoug Alomran</strong></p>
            <p>CS340 - Introduction to Database Systems</p>
        </div>
    </div>

    <script>
        const questions = [
            {
                type: 'mcq',
                question: 'Which of the following correctly defines a relation in the relational model?',
                options: [
                    'A collection of unrelated data stored in files',
                    'A two-dimensional table consisting of rows (tuples) and columns (attributes) with atomic values',
                    'A set of procedures for managing database files',
                    'A connection between two database tables'
                ],
                correct: 1,
                explanation: 'A relation is formally defined as a two-dimensional table where each row represents a tuple (entity instance) and each column represents an attribute. All values in cells must be atomic (indivisible, single-valued).',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'What is the degree (or arity) of a relation?',
                options: [
                    'The number of tuples in the relation',
                    'The number of attributes (columns) in the relation',
                    'The number of candidate keys',
                    'The total number of cells in the relation'
                ],
                correct: 1,
                explanation: 'The degree (or arity) of a relation refers to the number of columns/attributes. For example, a relation with 5 attributes has a degree of 5. The number of tuples (rows) is called the cardinality.',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'In the relational model, what is cardinality?',
                options: [
                    'The number of attributes in a relation',
                    'The number of tuples (rows) in a relation at a particular moment',
                    'The degree of dependency between two relations',
                    'The maximum number of relationships between entities'
                ],
                correct: 1,
                explanation: 'Cardinality refers to the number of tuples (rows) currently in a relation. It changes whenever data is inserted, deleted, or updated. Degree refers to the number of attributes. Cardinality is dynamic; degree is static.',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'Which of the following is a characteristic of the relational model?',
                options: [
                    'Allows composite and multivalued attributes within a single relation',
                    'All values in a tuple must be atomic (indivisible)',
                    'Tuples within a relation are ordered by default',
                    'Attributes can have NULL values without restriction'
                ],
                correct: 1,
                explanation: 'The First Normal Form (1NF) constraint requires that all values in a relation must be atomic. This means no composite or multivalued attributes are allowed within a single cell. Each cell contains exactly one value.',
                pastExam: true
            },
            {
                type: 'mcq',
                question: 'What is a superkey?',
                options: [
                    'A single attribute that uniquely identifies a tuple',
                    'A set of one or more attributes that uniquely identifies a tuple',
                    'The primary key of a relation',
                    'A foreign key that references another relation'
                ],
                correct: 1,
                explanation: 'A superkey is a set of attributes (one or more) that can uniquely identify a tuple in a relation. A key is a minimal superkey (removing any attribute makes it non-unique). Every key is a superkey, but not every superkey is a key.',
                pastExam: true
            },
            {
                type: 'mcq',
                question: 'What is the difference between a key and a superkey?',
                options: [
                    'There is no difference; they are the same thing',
                    'A key is a minimal superkey; removing any attribute from a key makes it non-unique',
                    'A superkey is always smaller than a key',
                    'A key can have NULL values, but a superkey cannot'
                ],
                correct: 1,
                explanation: 'A key is a MINIMAL superkey. This means: (1) It uniquely identifies each tuple, and (2) Removing any attribute from it would destroy the uniqueness property. A superkey doesn\'t have to be minimal.',
                pastExam: false
            },
            {
                type: 'mcq',
                question: 'Which constraint ensures that no primary key attribute can have a NULL value?',
                options: [
                    'Domain constraint',
                    'Entity integrity constraint',
                    'Referential integrity constraint',
                    'Key uniqueness constraint'
                ],
                correct: 1,
                explanation: 'Entity Integrity Constraint states that the primary key attributes of a relation cannot be NULL. This ensures that every tuple can be uniquely identified and distinguished from others.',
                pastExam: true
            },
            {
                type: 'mcq',
                question: 'What is the primary function of a foreign key?',
                options: [
                    'To uniquely identify a tuple within its own relation',
                    'To link tuples from one relation to tuples in another relation',
                    'To enforce domain constraints on attributes',
                    'To prevent duplicate values in a column'
                ],
                correct: 1,
                explanation: 'A foreign key is an attribute (or set of attributes) in one relation that references the primary key of another relation. It maintains relationships between tables and enforces referential integrity.',
                pastExam: true
            },
            {
                type: 'mcq',
                question: 'Which statement is true regarding Referential Integrity?',
                options: [
                    'Every primary-key value must match a primary-key value in an associated table',
                    'Every primary-key value must match a foreign-key value in an associated table',
                    'Every foreign-key value must match a foreign-key value in an associated table',
                    'Every foreign-key value must match a primary-key value in an associated table'
                ],
                correct: 3,
                explanation: 'Referential Integrity states that every value of a foreign key must either: (1) Match an existing primary key value in the referenced relation, or (2) Be NULL. This prevents orphaned records.',
                pastExam: true
            },
            {
                type: 'mcq',
                question: 'What does the domain constraint specify in the relational model?',
                options: [
                    'The relationship between two tables',
                    'That each attribute value must come from the specified data type domain',
                    'That primary keys must be unique',
                    'That no two tuples can have the same values'
                ],
                correct: 1,
                explanation: 'Domain constraints specify that each attribute value must be atomic and come from the specified domain (data type). For example, if an attribute is defined as INTEGER, only integer values are allowed.',
                pastExam: false
            },
            {
                type: 'truefalse',
                question: 'Entity Integrity constraint ensures that no primary key attribute can be null.',
                correct: true,
                explanation: 'TRUE. The Entity Integrity constraint requires all primary key attributes to have non-NULL values to ensure each tuple is uniquely identifiable.',
                pastExam: true
            },
            {
                type: 'truefalse',
                question: 'In the relational model, the order of tuples in a relation is significant.',
                correct: false,
                explanation: 'FALSE. The relational model treats a relation as a SET of tuples, not a sequence. Row order is not meaningful. The only order that matters is the order of attribute definitions in the schema.',
                pastExam: true
            },
            {
                type: 'truefalse',
                question: 'A relation can have multiple primary keys.',
                correct: false,
                explanation: 'FALSE. Each relation has exactly ONE primary key. However, a relation can have multiple CANDIDATE KEYS. One candidate key is chosen as the primary key; the others are called alternate keys.',
                pastExam: false
            },
            {
                type: 'truefalse',
                question: 'The degree of a relation can change dynamically as new records are inserted.',
                correct: false,
                explanation: 'FALSE. The degree (number of attributes) is fixed in the schema. Only cardinality (number of tuples) changes dynamically.',
                pastExam: false
            },
            {
                type: 'shortanswer',
                question: 'Define what a relation schema is and explain the difference between a relation schema and a relation instance.',
                keywords: ['schema', 'definition', 'structure', 'attributes', 'data types', 'instance', 'data', 'tuples', 'moment', 'static', 'dynamic'],
                modelAnswer: 'A relation schema is the logical description/definition of a relation, consisting of:\n- Relation name\n- Attribute names and their data types\n\nA relation instance is the actual data (tuples/rows) in the relation at a particular moment.\n\nKey differences:\n- Schema: Static (rarely changes), defines structure\n- Instance: Dynamic (changes with INSERT/UPDATE/DELETE), contains actual data',
                explanation: 'Schema defines WHAT data can be stored; instance shows WHAT data IS currently stored.',
                pastExam: false
            },
            {
                type: 'shortanswer',
                question: 'Explain the difference between a KEY and a SUPERKEY with an example.',
                keywords: ['minimal', 'unique', 'superkey', 'key', 'removing', 'identify', 'example', 'candidate'],
                modelAnswer: 'KEY: A minimal set of attributes that uniquely identifies tuples. Removing ANY attribute destroys uniqueness.\n\nSUPERKEY: Any set of attributes that uniquely identifies tuples, but may contain extra attributes.\n\nExample with Student relation:\nCandidate KEYS: {ID}, {Email}\nSUPERKEYS: {ID}, {Email}, {ID, Email}, {ID, Email, Name}\n\nEvery key IS a superkey, but not every superkey IS a key.',
                explanation: 'Choose keys over superkeys for efficiency - smaller attribute sets mean faster lookups.',
                pastExam: true
            },
            {
                type: 'shortanswer',
                question: 'List and explain at least 4 characteristics that define a relation in the relational model.',
                keywords: ['atomic', 'duplicate', 'unordered', 'domain', 'unique', 'tuple', 'values', 'indivisible', 'set'],
                modelAnswer: '1. ATOMIC VALUES: All values must be indivisible (First Normal Form)\n\n2. NO DUPLICATE TUPLES: Each tuple is unique\n\n3. UNORDERED TUPLES: Tuples are treated as a SET, not a sequence\n\n4. UNORDERED ATTRIBUTES: Column order is not significant\n\n5. DOMAIN CONSTRAINT: Each attribute has a defined data type\n\n6. TUPLE UNIQUENESS: Every tuple is uniquely identifiable via primary key',
                explanation: 'These characteristics form the foundation of the relational model.',
                pastExam: false
            },
            {
                type: 'shortanswer',
                question: 'Explain Entity Integrity and Referential Integrity constraints and their importance.',
                keywords: ['primary key', 'null', 'entity integrity', 'referential integrity', 'foreign key', 'relationship', 'valid', 'orphaned'],
                modelAnswer: 'ENTITY INTEGRITY:\n- Primary key attributes cannot be NULL\n- Ensures each tuple is uniquely identifiable\n\nREFERENTIAL INTEGRITY:\n- Foreign key values must match existing primary key values or be NULL\n- Prevents orphaned records\n\nIMPORTANCE:\n- Entity Integrity: Guarantees tuple identity\n- Referential Integrity: Maintains consistency between tables',
                explanation: 'These constraints prevent invalid and inconsistent data.',
                pastExam: true
            },
            {
                type: 'problem',
                question: 'Given the CAR relation: CAR(State, Reg#, SerialNo, Make, Model, Year)\n\nData:\n| State | Reg# | SerialNo | Make  | Model |\n| TX    | 1234 | ABC123   | Ford  | Focus |\n| CA    | 5678 | XYZ789   | Honda | Civic |\n\nIdentify: (a) All candidate keys, (b) List 3 superkeys, (c) Choose and justify a primary key.',
                keywords: ['State, Reg', 'SerialNo', 'candidate', 'unique', 'superkey', 'primary', 'minimal', 'combination'],
                modelAnswer: '(a) CANDIDATE KEYS:\n- {State, Reg#}\n- {SerialNo}\n\n(b) SUPERKEYS:\n1. {SerialNo}\n2. {State, Reg#}\n3. {State, Reg#, SerialNo}\n4. {SerialNo, Make}\n\n(c) PRIMARY KEY: {SerialNo}\n\nJustification: Single attribute, smaller than {State, Reg#}, faster lookups, globally unique like VIN.',
                explanation: 'Choose the smallest candidate key for efficiency.',
                pastExam: true
            },
            {
                type: 'problem',
                question: 'Given schema:\nEMPLOYEE(SSN, Name, Salary, DeptNo)\nDEPARTMENT(DeptNo, DeptName, Location)\n\nIdentify: (a) Primary keys, (b) Foreign keys, (c) Explain referential integrity here.',
                keywords: ['SSN', 'DeptNo', 'primary key', 'foreign key', 'referential integrity', 'references', 'match', 'exists'],
                modelAnswer: '(a) PRIMARY KEYS:\n- EMPLOYEE.SSN\n- DEPARTMENT.DeptNo\n\n(b) FOREIGN KEY:\n- EMPLOYEE.DeptNo ‚Üí DEPARTMENT.DeptNo\n\n(c) REFERENTIAL INTEGRITY:\nEvery DeptNo in EMPLOYEE must either:\n- Match an existing DeptNo in DEPARTMENT, OR\n- Be NULL\n\nPrevents assigning employees to non-existent departments.',
                explanation: 'Foreign keys maintain relationships and data consistency across tables.',
                pastExam: false
            }
        ];

        let currentQuestionIndex = 0;
        let answers = [];
        let submitted = false;

        function initExam() {
            document.getElementById('totalQuestionsNav').textContent = questions.length;
            answers = new Array(questions.length).fill(null);
            document.getElementById('navigation').style.display = 'flex';
            renderQuestion();
        }

        function renderQuestion() {
            const examContent = document.getElementById('examContent');
            examContent.innerHTML = '';
            
            const q = questions[currentQuestionIndex];
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-container active';

            let badgeHtml = '';
            if (q.pastExam) {
                badgeHtml = `<span class="badge past-exam">üìã Past Exam</span>`;
            } else {
                badgeHtml = `<span class="badge generated">‚ú® Generated</span>`;
            }
            
            let questionHTML = `
                <div class="question-header">
                    <span class="question-title">Question ${currentQuestionIndex + 1}/${questions.length}</span>
                    ${badgeHtml}
                </div>
                <div class="question-text">${q.question}</div>
            `;

            if (q.type === 'mcq') {
                questionHTML += '<div>';
                q.options.forEach((option, idx) => {
                    const isSelected = answers[currentQuestionIndex] === idx;
                    
                    let className = 'option';
                    if (isSelected) className += ' selected';
                    
                    questionHTML += `
                        <label class="${className}">
                            <input type="radio" name="answer" value="${idx}" 
                                ${isSelected ? 'checked' : ''}
                                onchange="selectAnswer(${idx})">
                            <span>${option}</span>
                        </label>
                    `;
                });
                questionHTML += '</div>';
            } else if (q.type === 'truefalse') {
                const selected = answers[currentQuestionIndex];
                questionHTML += `
                    <div>
                        <label class="option ${selected === true ? 'selected' : ''}">
                            <input type="radio" name="answer" value="true" 
                                ${selected === true ? 'checked' : ''}
                                onchange="selectAnswer(true)">
                            <span>True</span>
                        </label>
                        <label class="option ${selected === false ? 'selected' : ''}">
                            <input type="radio" name="answer" value="false" 
                                ${selected === false ? 'checked' : ''}
                                onchange="selectAnswer(false)">
                            <span>False</span>
                        </label>
                    </div>
                `;
            } else if (q.type === 'shortanswer' || q.type === 'problem') {
                const answer = answers[currentQuestionIndex] || '';
                questionHTML += `
                    <textarea id="answerText" 
                        onchange="selectAnswer(this.value)"
                        onkeyup="selectAnswer(this.value)">${answer}</textarea>
                `;
            }

            questionDiv.innerHTML = questionHTML;
            examContent.appendChild(questionDiv);
            updateProgress();
        }

        function selectAnswer(answer) {
            answers[currentQuestionIndex] = answer;
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
                document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
                window.scrollTo(0, 0);
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
                document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
                window.scrollTo(0, 0);
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.querySelector('.progress-fill').style.width = progress + '%';
        }

        function submitAllAnswers() {
            submitted = true;
            document.getElementById('submitAllBtn').style.display = 'none';
            document.getElementById('navigation').style.display = 'none';
            showResults();
        }

        function gradeWrittenAnswer(answer, keywords) {
            const answerLower = (answer || '').toLowerCase();
            const matchedKeywords = keywords.filter(kw => 
                answerLower.includes(kw.toLowerCase())
            );
            const matchPercentage = (matchedKeywords.length / keywords.length) * 100;
            return {
                matched: matchedKeywords,
                total: keywords.length,
                percentage: matchPercentage
            };
        }

        function showResults() {
            let correctCount = 0;
            const results = [];

            answers.forEach((answer, idx) => {
                const q = questions[idx];
                if (q.type === 'mcq' || q.type === 'truefalse') {
                    if (answer === q.correct) {
                        correctCount++;
                        results.push({
                            questionIdx: idx,
                            isCorrect: true,
                            type: q.type
                        });
                    } else {
                        results.push({
                            questionIdx: idx,
                            isCorrect: false,
                            type: q.type,
                            userAnswer: answer,
                            correctAnswer: q.correct
                        });
                    }
                } else {
                    const grading = gradeWrittenAnswer(answer, q.keywords);
                    const isPassing = grading.percentage >= 60;
                    if (isPassing) correctCount++;
                    
                    results.push({
                        questionIdx: idx,
                        type: q.type,
                        grading: grading,
                        userAnswer: answer
                    });
                }
            });

            const percentage = Math.round((correctCount / questions.length) * 100);
            document.getElementById('scorePercentage').textContent = percentage + '%';
            document.getElementById('totalQuestions').textContent = questions.length;
            document.getElementById('correctAnswers').textContent = correctCount;
            document.getElementById('incorrectAnswers').textContent = questions.length - correctCount;

            let message = '';
            if (percentage === 100) {
                message = 'Perfect score! You have mastered Chapter 4! üéØ';
            } else if (percentage >= 80) {
                message = 'Excellent work! You have a strong understanding of the Relational Model. üåü';
            } else if (percentage >= 60) {
                message = 'Good job! Review the concepts you missed to solidify your understanding. üìö';
            } else {
                message = 'Keep studying! Focus on the key concepts and take the exam again. üí™';
            }

            document.getElementById('resultMessage').textContent = message;

            generateReview(results);

            document.getElementById('examContent').innerHTML = '';
            document.getElementById('resultsContainer').classList.add('show');
            window.scrollTo(0, 0);
        }

        function generateReview(results) {
            const reviewSection = document.getElementById('reviewSection');
            reviewSection.innerHTML = '<h3 style="margin-bottom: 20px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">Detailed Review</h3>';

            results.forEach((result, idx) => {
                const q = questions[result.questionIdx];
                const reviewDiv = document.createElement('div');
                reviewDiv.className = 'review-question';

                let reviewHTML = `
                    <div class="review-title">Question ${result.questionIdx + 1}: ${q.type === 'mcq' ? 'Multiple Choice' : q.type === 'truefalse' ? 'True/False' : 'Short Answer'}</div>
                    <div style="margin: 10px 0; color: #666; font-size: 0.95em;">${q.question}</div>
                `;

                if (q.type === 'mcq' || q.type === 'truefalse') {
                    if (result.isCorrect) {
                        reviewHTML += `<div style="color: #10b981; font-weight: 600;">‚úì Correct</div>`;
                    } else {
                        const userAnswerText = q.type === 'mcq' ? q.options[result.userAnswer] : (result.userAnswer ? 'True' : 'False');
                        const correctAnswerText = q.type === 'mcq' ? q.options[result.correctAnswer] : (result.correctAnswer ? 'True' : 'False');
                        reviewHTML += `
                            <div style="color: #ef4444; font-weight: 600;">‚úó Incorrect</div>
                            <div class="your-answer"><strong>Your answer:</strong> ${userAnswerText}</div>
                            <div class="your-answer"><strong>Correct answer:</strong> ${correctAnswerText}</div>
                        `;
                    }
                } else {
                    const grading = result.grading;
                    const isPassing = grading.percentage >= 60;
                    reviewHTML += `
                        <div style="color: ${isPassing ? '#10b981' : '#ef4444'}; font-weight: 600;">
                            ${isPassing ? '‚úì' : '‚úó'} Score: ${Math.round(grading.percentage)}% (${grading.matched.length}/${grading.total} key concepts)
                        </div>
                        <div class="your-answer"><strong>Your answer:</strong> ${result.userAnswer}</div>
                        <div style="margin-top: 10px; padding: 10px; background: rgba(251, 191, 36, 0.1); border-left: 3px solid #fbbf24; font-size: 0.9em;">
                            <strong>Key concepts found:</strong> ${grading.matched.length > 0 ? grading.matched.join(', ') : 'None detected'}
                        </div>
                        <div style="margin-top: 10px; padding: 10px; background: rgba(59, 130, 246, 0.1); border-left: 3px solid #3b82f6; font-size: 0.9em;">
                            <strong>Expected key concepts:</strong> ${q.keywords.join(', ')}
                        </div>
                    `;
                }

                reviewHTML += `
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                        <div style="font-size: 0.95em; line-height: 1.6;">${q.explanation}</div>
                    </div>
                `;

                if (q.type === 'shortanswer' || q.type === 'problem') {
                    reviewHTML += `
                        <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.05); border-left: 3px solid #667eea; font-family: 'Courier New', monospace; font-size: 0.9em; white-space: pre-wrap; line-height: 1.6;">
                            <strong>Model answer:</strong>\n${q.modelAnswer}
                        </div>
                    `;
                }

                reviewDiv.innerHTML = reviewHTML;
                reviewSection.appendChild(reviewDiv);
            });
        }

        window.addEventListener('load', initExam);
    </script>
</body>
</html>