<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 7: Advanced SQL - Comprehensive Exam</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .exam-info {
            background: #f8f9fa;
            padding: 20px;
            border-left: 5px solid #667eea;
            margin: 20px;
        }

        .content {
            padding: 40px;
        }

        .question-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .question-number {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
        }

        .question-points {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .past-exam-badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .question-text {
            font-size: 1.1em;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .code-context {
            background: #2d3436;
            color: #00b894;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
        }

        .options {
            margin-left: 20px;
        }

        .option {
            margin: 12px 0;
            padding: 12px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option input[type="radio"],
        .option input[type="checkbox"] {
            margin-right: 10px;
            cursor: pointer;
        }

        .option label {
            cursor: pointer;
            display: inline;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1em;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .code-textarea {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
        }

        .submit-section {
            text-align: center;
            margin: 40px 0;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            font-size: 1.2em;
            cursor: pointer;
            transition: transform 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        .results {
            display: none;
            margin: 30px 0;
            padding: 30px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 10px;
        }

        .results.show {
            display: block;
        }

        .score-display {
            text-align: center;
            font-size: 2em;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 20px;
        }

        .grade-badge {
            display: inline-block;
            padding: 10px 30px;
            border-radius: 25px;
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            margin: 10px;
        }

        .grade-a { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .grade-b { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .grade-c { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .grade-f { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border-left: 5px solid #e17055;
        }

        .feedback-correct {
            border-left-color: #00b894;
        }

        .feedback-incorrect {
            border-left-color: #d63031;
        }

        .feedback h4 {
            margin-bottom: 10px;
            color: #2d3436;
        }

        .explanation {
            background: #fff5e6;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 3px solid #ff9800;
        }

        .model-answer {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 3px solid #4caf50;
        }

        .keywords-found {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.95em;
        }

        footer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        footer p {
            font-size: 1.1em;
            margin: 5px 0;
        }

        .section-title {
            font-size: 1.8em;
            color: #667eea;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .hint {
            background: #fff3cd;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 3px solid #ffc107;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }
            
            header h1 {
                font-size: 1.8em;
            }
        }
    </style>
  <script src="/javascripts/standalone-theme.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö Chapter 7: Advanced SQL</h1>
            <p>Comprehensive Examination</p>
            <p style="font-size: 0.9em; margin-top: 10px;">CS340: Database Systems</p>
        </header>

        <div class="exam-info">
            <h3>Exam Information</h3>
            <p><strong>Total Points:</strong> 100</p>
            <p><strong>Time:</strong> Self-paced</p>
            <p><strong>Instructions:</strong> Answer all questions. Some questions are marked as "Past Exam" from previous exams. For written questions, include key concepts for full credit.</p>
        </div>

        <div class="content">
            <!-- Section 1: Multiple Choice -->
            <h2 class="section-title">Section 1: Multiple Choice Questions (40 points)</h2>

            <!-- Question 1 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 1</span>
                    <div>
                        <span class="past-exam-badge">PAST EXAM</span>
                        <span class="question-points">4 points</span>
                    </div>
                </div>
                <div class="question-text">
                    Which of the following SQL queries will return sailors who have reserved boat number 103?
                </div>
                <div class="code-context">
Sailors(sid, sname, rating, age)
Reserves(sid, bid, day)
Boats(bid, bname, color)
                </div>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q1" id="q1a" value="a">
                        <label for="q1a">SELECT sname FROM Sailors WHERE sid = 103;</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q1" id="q1b" value="b">
                        <label for="q1b">SELECT S.sname FROM Sailors S, Reserves R WHERE S.sid = R.sid AND R.bid = 103;</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q1" id="q1c" value="c">
                        <label for="q1c">SELECT sname FROM Sailors WHERE bid = 103;</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q1" id="q1d" value="d">
                        <label for="q1d">SELECT * FROM Reserves WHERE sid = 103;</label>
                    </div>
                </div>
            </div>

            <!-- Question 2 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 2</span>
                    <div>
                        <span class="past-exam-badge">PAST EXAM</span>
                        <span class="question-points">4 points</span>
                    </div>
                </div>
                <div class="question-text">
                    What is the difference between WHERE and HAVING clauses in SQL?
                </div>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q2" id="q2a" value="a">
                        <label for="q2a">WHERE filters tuples before grouping, HAVING filters groups after grouping</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q2" id="q2b" value="b">
                        <label for="q2b">WHERE and HAVING are exactly the same</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q2" id="q2c" value="c">
                        <label for="q2c">WHERE is used with aggregates, HAVING is not</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q2" id="q2d" value="d">
                        <label for="q2d">HAVING can only be used with COUNT function</label>
                    </div>
                </div>
            </div>

            <!-- Question 3 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 3</span>
                    <div>
                        <span class="question-points">4 points</span>
                    </div>
                </div>
                <div class="question-text">
                    Which SQL query returns the name and age of the youngest sailor?
                </div>
                <div class="code-context">
Sailors(sid, sname, rating, age)
                </div>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q3" id="q3a" value="a">
                        <label for="q3a">SELECT sname, age FROM Sailors WHERE age = MIN(age);</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q3" id="q3b" value="b">
                        <label for="q3b">SELECT sname, age FROM Sailors WHERE age <= ALL(SELECT age FROM Sailors);</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q3" id="q3c" value="c">
                        <label for="q3c">SELECT MIN(age) FROM Sailors;</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q3" id="q3d" value="d">
                        <label for="q3d">SELECT sname, age FROM Sailors ORDER BY age LIMIT 1;</label>
                    </div>
                </div>
            </div>

            <!-- Question 4 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 4</span>
                    <div>
                        <span class="past-exam-badge">PAST EXAM</span>
                        <span class="question-points">4 points</span>
                    </div>
                </div>
                <div class="question-text">
                    What is the result of a LEFT OUTER JOIN?
                </div>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q4" id="q4a" value="a">
                        <label for="q4a">Returns only matching tuples from both tables</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q4" id="q4b" value="b">
                        <label for="q4b">Returns all tuples from the left table, with NULLs for non-matching right table tuples</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q4" id="q4c" value="c">
                        <label for="q4c">Returns all tuples from the right table only</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q4" id="q4d" value="d">
                        <label for="q4d">Returns the Cartesian product of both tables</label>
                    </div>
                </div>
            </div>

            <!-- Question 5 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 5</span>
                    <div>
                        <span class="question-points">4 points</span>
                    </div>
                </div>
                <div class="question-text">
                    Which aggregate function should be used to count unique values in a column?
                </div>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q5" id="q5a" value="a">
                        <label for="q5a">COUNT(*)</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q5" id="q5b" value="b">
                        <label for="q5b">COUNT(DISTINCT column_name)</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q5" id="q5c" value="c">
                        <label for="q5c">SUM(DISTINCT column_name)</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q5" id="q5d" value="d">
                        <label for="q5d">UNIQUE(column_name)</label>
                    </div>
                </div>
            </div>

            <!-- Question 6 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 6</span>
                    <div>
                        <span class="past-exam-badge">PAST EXAM</span>
                        <span class="question-points">4 points</span>
                    </div>
                </div>
                <div class="question-text">
                    What does the EXISTS operator do in a nested query?
                </div>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q6" id="q6a" value="a">
                        <label for="q6a">Returns TRUE if the subquery returns at least one tuple</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q6" id="q6b" value="b">
                        <label for="q6b">Returns TRUE only if the subquery returns exactly one tuple</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q6" id="q6c" value="c">
                        <label for="q6c">Counts the number of tuples in the subquery</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q6" id="q6d" value="d">
                        <label for="q6d">Checks if a value exists in a list</label>
                    </div>
                </div>
            </div>

            <!-- Question 7 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 7</span>
                    <div>
                        <span class="question-points">4 points</span>
                    </div>
                </div>
                <div class="question-text">
                    What is the purpose of a VIEW in SQL?
                </div>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q7" id="q7a" value="a">
                        <label for="q7a">To permanently store query results</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q7" id="q7b" value="b">
                        <label for="q7b">To create a virtual table based on a query that doesn't store data physically</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q7" id="q7c" value="c">
                        <label for="q7c">To delete tables from the database</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q7" id="q7d" value="d">
                        <label for="q7d">To create indexes on tables</label>
                    </div>
                </div>
            </div>

            <!-- Question 8 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 8</span>
                    <div>
                        <span class="question-points">4 points</span>
                    </div>
                </div>
                <div class="question-text">
                    Which of the following is a correlated nested query?
                </div>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q8" id="q8a" value="a">
                        <label for="q8a">SELECT * FROM Employee WHERE Dno IN (SELECT Dnumber FROM Department);</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q8" id="q8b" value="b">
                        <label for="q8b">SELECT * FROM Employee E WHERE Salary > (SELECT AVG(Salary) FROM Employee WHERE Dno = E.Dno);</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q8" id="q8c" value="c">
                        <label for="q8c">SELECT MAX(Salary) FROM Employee;</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q8" id="q8d" value="d">
                        <label for="q8d">SELECT * FROM Employee WHERE Salary > 50000;</label>
                    </div>
                </div>
            </div>

            <!-- Question 9 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 9</span>
                    <div>
                        <span class="past-exam-badge">PAST EXAM</span>
                        <span class="question-points">4 points</span>
                    </div>
                </div>
                <div class="question-text">
                    What is NULL in SQL?
                </div>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q9" id="q9a" value="a">
                        <label for="q9a">A special value representing unknown, unavailable, or not applicable data</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q9" id="q9b" value="b">
                        <label for="q9b">The number zero</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q9" id="q9c" value="c">
                        <label for="q9c">An empty string</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q9" id="q9d" value="d">
                        <label for="q9d">A boolean false value</label>
                    </div>
                </div>
            </div>

            <!-- Question 10 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 10</span>
                    <div>
                        <span class="question-points">4 points</span>
                    </div>
                </div>
                <div class="question-text">
                    Which operator is used to check if a value is NULL?
                </div>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q10" id="q10a" value="a">
                        <label for="q10a">= NULL</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q10" id="q10b" value="b">
                        <label for="q10b">IS NULL</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q10" id="q10c" value="c">
                        <label for="q10c">== NULL</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q10" id="q10d" value="d">
                        <label for="q10d">NULL?</label>
                    </div>
                </div>
            </div>

            <!-- Section 2: SQL Query Writing -->
            <h2 class="section-title">Section 2: SQL Query Writing (30 points)</h2>

            <div class="exam-info">
                <p><strong>Database Schema for Questions 11-14:</strong></p>
                <div class="code-context">
Student(StudentID, Name, Major, GPA)
Course(CourseID, Title, Credits, DeptName)
Enrollment(StudentID, CourseID, Grade, Semester)
                </div>
            </div>

            <!-- Question 11 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 11</span>
                    <div>
                        <span class="past-exam-badge">PAST EXAM</span>
                        <span class="question-points">8 points</span>
                    </div>
                </div>
                <div class="question-text">
                    Write an SQL query to find the names of all students who have a GPA greater than 3.5 and are majoring in 'CS'. Use proper SQL syntax.
                </div>
                <div class="hint">
                    Hint: Use SELECT, FROM, WHERE with AND condition
                </div>
                <textarea id="q11" class="code-textarea" placeholder="Write your SQL query here..."></textarea>
            </div>

            <!-- Question 12 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 12</span>
                    <div>
                        <span class="past-exam-badge">PAST EXAM</span>
                        <span class="question-points">8 points</span>
                    </div>
                </div>
                <div class="question-text">
                    Write an SQL query to find the average GPA for each major. Display the major name and average GPA. Order results by average GPA in descending order.
                </div>
                <div class="hint">
                    Hint: Use GROUP BY with AVG() aggregate function and ORDER BY
                </div>
                <textarea id="q12" class="code-textarea" placeholder="Write your SQL query here..."></textarea>
            </div>

            <!-- Question 13 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 13</span>
                    <div>
                        <span class="question-points">7 points</span>
                    </div>
                </div>
                <div class="question-text">
                    Write an SQL query to find all students enrolled in 'CS340' course using a JOIN operation. Display student name and course title.
                </div>
                <div class="hint">
                    Hint: Join Student, Enrollment, and Course tables
                </div>
                <textarea id="q13" class="code-textarea" placeholder="Write your SQL query here..."></textarea>
            </div>

            <!-- Question 14 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 14</span>
                    <div>
                        <span class="question-points">7 points</span>
                    </div>
                </div>
                <div class="question-text">
                    Write an SQL query to find majors that have more than 5 students with GPA above 3.0. Display the major name and count of students.
                </div>
                <div class="hint">
                    Hint: Use WHERE to filter GPA, GROUP BY major, and HAVING for count condition
                </div>
                <textarea id="q14" class="code-textarea" placeholder="Write your SQL query here..."></textarea>
            </div>

            <!-- Section 3: Conceptual Questions -->
            <h2 class="section-title">Section 3: Short Answer Questions (30 points)</h2>

            <!-- Question 15 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 15</span>
                    <div>
                        <span class="past-exam-badge">PAST EXAM</span>
                        <span class="question-points">10 points</span>
                    </div>
                </div>
                <div class="question-text">
                    Explain the difference between INNER JOIN and LEFT OUTER JOIN with an example. In your answer, describe when each should be used and what happens to non-matching tuples.
                </div>
                <div class="hint">
                    Key concepts to include: matching tuples, NULL values, use cases, non-matching behavior
                </div>
                <textarea id="q15" placeholder="Write your answer here..."></textarea>
            </div>

            <!-- Question 16 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 16</span>
                    <div>
                        <span class="past-exam-badge">PAST EXAM</span>
                        <span class="question-points">10 points</span>
                    </div>
                </div>
                <div class="question-text">
                    What are aggregate functions in SQL? List at least 4 aggregate functions and explain what each one does. Provide an example scenario where you would use GROUP BY with an aggregate function.
                </div>
                <div class="hint">
                    Key concepts: COUNT, SUM, AVG, MAX, MIN, GROUP BY, examples
                </div>
                <textarea id="q16" placeholder="Write your answer here..."></textarea>
            </div>

            <!-- Question 17 -->
            <div class="question-section">
                <div class="question-header">
                    <span class="question-number">Question 17</span>
                    <div>
                        <span class="question-points">10 points</span>
                    </div>
                </div>
                <div class="question-text">
                    Explain what a VIEW is in SQL. Discuss the difference between materialized and non-materialized views. What are the advantages of using views in database design?
                </div>
                <div class="hint">
                    Key concepts: virtual table, materialized vs non-materialized, security, simplification, advantages
                </div>
                <textarea id="q17" placeholder="Write your answer here..."></textarea>
            </div>

            <!-- Submit Button -->
            <div class="submit-section">
                <button class="submit-btn" onclick="gradeExam()">Submit Exam</button>
                <p style="margin-top: 15px; color: #666;">Make sure you've answered all questions before submitting!</p>
            </div>

            <!-- Results Section -->
            <div class="results" id="results">
                <div class="score-display" id="scoreDisplay"></div>
                <div id="feedback"></div>
            </div>
        </div>

        <footer>
            <p style="font-size: 1.3em; font-weight: bold;">Good Luck! üçÄ</p>
            <p style="margin-top: 15px;">Prepared by: Shoug Alomran</p>
            <p style="font-size: 0.9em; margin-top: 5px; opacity: 0.9;">CS340 - Database Systems</p>
        </footer>
    </div>

    <script>
        // Answer key and explanations
        const answers = {
            q1: {
                correct: 'b',
                explanation: 'Option B correctly joins Sailors and Reserves tables on sid and filters for bid = 103. This returns sailor names who have reserved boat 103. Option A checks sid = 103 (wrong attribute), C tries to use bid in Sailors table (doesn\'t exist), and D returns reservation records, not sailor names.',
                points: 4
            },
            q2: {
                correct: 'a',
                explanation: 'WHERE filters individual tuples BEFORE grouping occurs, while HAVING filters groups AFTER grouping. WHERE cannot use aggregate functions directly, but HAVING can. For example: WHERE Salary > 30000 filters employees first, then GROUP BY groups them, then HAVING COUNT(*) > 5 filters the groups.',
                points: 4
            },
            q3: {
                correct: 'b',
                explanation: 'Option B uses ALL to compare with all ages in the subquery, correctly finding the youngest. Option A won\'t work because you can\'t use aggregate in WHERE without subquery. Option C returns only the age, not name. Option D works in MySQL but isn\'t standard SQL and doesn\'t handle ties.',
                points: 4
            },
            q4: {
                correct: 'b',
                explanation: 'LEFT OUTER JOIN returns ALL tuples from the left table. If a left tuple has no match in the right table, NULL values are filled in for right table attributes. INNER JOIN (A) only returns matches. RIGHT OUTER JOIN (C) keeps all right tuples. CROSS JOIN (D) is Cartesian product.',
                points: 4
            },
            q5: {
                correct: 'b',
                explanation: 'COUNT(DISTINCT column_name) counts only unique/distinct values in a column. COUNT(*) counts all rows including duplicates. SUM(DISTINCT) adds unique values (rarely used). UNIQUE() is not a standard SQL function.',
                points: 4
            },
            q6: {
                correct: 'a',
                explanation: 'EXISTS returns TRUE if the subquery result contains at least one tuple, FALSE otherwise. It\'s used for checking existence, not counting. NOT EXISTS checks for non-existence. EXISTS is often more efficient than IN for large datasets because it stops as soon as it finds one match.',
                points: 4
            },
            q7: {
                correct: 'b',
                explanation: 'A VIEW is a virtual table defined by a query. It doesn\'t physically store data (unless materialized). Views are useful for: security (hiding sensitive columns), simplifying complex queries, providing different user perspectives, and abstracting the database structure.',
                points: 4
            },
            q8: {
                correct: 'b',
                explanation: 'Option B is correlated because the subquery references the outer query (E.Dno). The subquery must be executed for each tuple in the outer query. Non-correlated queries (A, C, D) execute the subquery once and use the result in the outer query.',
                points: 4
            },
            q9: {
                correct: 'a',
                explanation: 'NULL represents unknown, unavailable, or not applicable data. It\'s NOT zero (numeric), empty string (text), or false (boolean). NULL has special comparison rules: NULL = NULL evaluates to UNKNOWN (not TRUE). Use IS NULL or IS NOT NULL to check for NULL values.',
                points: 4
            },
            q10: {
                correct: 'b',
                explanation: 'IS NULL is the correct operator to check for NULL values. = NULL doesn\'t work because NULL = NULL evaluates to UNKNOWN in SQL\'s three-valued logic. Use: WHERE column IS NULL or WHERE column IS NOT NULL.',
                points: 4
            },
            q11: {
                modelAnswer: "SELECT Name\nFROM Student\nWHERE GPA > 3.5 AND Major = 'CS';",
                keywords: ['SELECT', 'Name', 'FROM', 'Student', 'WHERE', 'GPA', '3.5', 'Major', 'CS', 'AND'],
                requiredKeywords: ['SELECT', 'FROM', 'Student', 'WHERE', 'AND'],
                points: 8,
                rubric: {
                    'SELECT Name or SELECT *': 2,
                    'FROM Student': 2,
                    'WHERE clause': 1,
                    'GPA > 3.5': 1.5,
                    'Major = CS': 1.5,
                    'AND operator': 1
                }
            },
            q12: {
                modelAnswer: "SELECT Major, AVG(GPA) AS AvgGPA\nFROM Student\nGROUP BY Major\nORDER BY AvgGPA DESC;",
                keywords: ['SELECT', 'Major', 'AVG', 'GPA', 'FROM', 'Student', 'GROUP BY', 'ORDER BY', 'DESC'],
                requiredKeywords: ['SELECT', 'AVG', 'GROUP BY', 'Major'],
                points: 8,
                rubric: {
                    'SELECT Major': 1.5,
                    'AVG(GPA)': 2,
                    'FROM Student': 1.5,
                    'GROUP BY Major': 2,
                    'ORDER BY DESC': 1
                }
            },
            q13: {
                modelAnswer: "SELECT S.Name, C.Title\nFROM Student S\nJOIN Enrollment E ON S.StudentID = E.StudentID\nJOIN Course C ON E.CourseID = C.CourseID\nWHERE C.CourseID = 'CS340';",
                keywords: ['SELECT', 'Name', 'Title', 'FROM', 'Student', 'JOIN', 'Enrollment', 'Course', 'ON', 'StudentID', 'CourseID', 'WHERE', 'CS340'],
                requiredKeywords: ['SELECT', 'FROM', 'JOIN', 'ON'],
                points: 7,
                rubric: {
                    'SELECT S.Name, C.Title': 1.5,
                    'FROM Student': 1,
                    'JOIN Enrollment': 1.5,
                    'JOIN Course': 1.5,
                    'ON conditions (both)': 1,
                    'WHERE CourseID = CS340': 0.5
                }
            },
            q14: {
                modelAnswer: "SELECT Major, COUNT(*) AS StudentCount\nFROM Student\nWHERE GPA > 3.0\nGROUP BY Major\nHAVING COUNT(*) > 5;",
                keywords: ['SELECT', 'Major', 'COUNT', 'FROM', 'Student', 'WHERE', 'GPA', '3.0', 'GROUP BY', 'HAVING', '5'],
                requiredKeywords: ['SELECT', 'COUNT', 'GROUP BY', 'HAVING', 'WHERE'],
                points: 7,
                rubric: {
                    'SELECT Major, COUNT(*)': 1.5,
                    'FROM Student': 0.5,
                    'WHERE GPA > 3.0': 1.5,
                    'GROUP BY Major': 1.5,
                    'HAVING COUNT(*) > 5': 2
                }
            },
            q15: {
                modelAnswer: "INNER JOIN returns only the tuples that have matching values in both tables. If a tuple in one table has no match in the other table, it is excluded from the result.\n\nLEFT OUTER JOIN returns ALL tuples from the left table. If a tuple from the left table has no match in the right table, it is still included in the result, but NULL values are filled in for the right table's attributes.\n\nExample:\nStudent(ID, Name): (1, Ali), (2, Sara), (3, Omar)\nEnrollment(StudentID, Course): (1, CS340), (2, CS101)\n\nINNER JOIN returns: (1, Ali, CS340), (2, Sara, CS101)\nLEFT OUTER JOIN returns: (1, Ali, CS340), (2, Sara, CS101), (3, Omar, NULL)\n\nUse INNER JOIN when you only want records with matches in both tables. Use LEFT OUTER JOIN when you want all records from the left table regardless of whether they have matches.",
                keywords: ['INNER JOIN', 'LEFT OUTER JOIN', 'matching', 'NULL', 'all tuples', 'left table', 'right table', 'both tables', 'example', 'use case'],
                requiredKeywords: ['INNER JOIN', 'LEFT OUTER JOIN', 'matching', 'NULL'],
                points: 10,
                rubric: {
                    'INNER JOIN definition': 2,
                    'LEFT OUTER JOIN definition': 2,
                    'NULL handling explanation': 2,
                    'Example provided': 2,
                    'Use cases mentioned': 2
                }
            },
            q16: {
                modelAnswer: "Aggregate functions in SQL perform calculations on a set of values and return a single value. Common aggregate functions include:\n\n1. COUNT(): Counts the number of rows/values. Example: COUNT(*) counts all rows, COUNT(column) counts non-NULL values.\n\n2. SUM(): Calculates the sum of numeric values. Example: SUM(Salary) adds all salaries.\n\n3. AVG(): Calculates the average of numeric values. Example: AVG(GPA) finds average GPA.\n\n4. MAX(): Returns the maximum value. Example: MAX(Age) finds oldest age.\n\n5. MIN(): Returns the minimum value. Example: MIN(Price) finds lowest price.\n\nGROUP BY Example:\nTo find the average salary per department:\nSELECT DeptName, AVG(Salary)\nFROM Employee\nGROUP BY DeptName;\n\nThis groups employees by department and calculates average salary for each department. Without GROUP BY, aggregate functions work on all rows.",
                keywords: ['aggregate', 'COUNT', 'SUM', 'AVG', 'MAX', 'MIN', 'GROUP BY', 'calculations', 'single value', 'example', 'department'],
                requiredKeywords: ['aggregate', 'COUNT', 'SUM', 'AVG', 'GROUP BY'],
                points: 10,
                rubric: {
                    'Definition of aggregate functions': 2,
                    'COUNT explanation': 1,
                    'SUM explanation': 1,
                    'AVG explanation': 1,
                    'MAX explanation': 0.5,
                    'MIN explanation': 0.5,
                    'GROUP BY example': 2,
                    'GROUP BY explanation': 2
                }
            },
            q17: {
                modelAnswer: "A VIEW in SQL is a virtual table defined by a query. It doesn't physically store data but represents data from one or more base tables.\n\nNon-Materialized View:\n- Standard view that doesn't store data\n- Executes the underlying query each time it's accessed\n- Always shows current data from base tables\n- Suitable for frequently changing data\n- No storage overhead\n\nMaterialized View:\n- Physically stores the query result\n- Data is pre-computed and stored on disk\n- Must be refreshed to reflect changes in base tables\n- Much faster for complex queries on large datasets\n- Uses storage space\n\nAdvantages of Views:\n1. Security: Hide sensitive columns from certain users\n2. Simplification: Complex queries can be saved as simple views\n3. Data Independence: Applications use views instead of base tables\n4. Abstraction: Provide different perspectives for different users\n5. Consistency: Ensure users see data in specific format",
                keywords: ['VIEW', 'virtual table', 'materialized', 'non-materialized', 'query', 'storage', 'refresh', 'security', 'simplification', 'advantages', 'base tables'],
                requiredKeywords: ['VIEW', 'virtual', 'materialized', 'non-materialized'],
                points: 10,
                rubric: {
                    'VIEW definition': 2,
                    'Non-materialized explanation': 2,
                    'Materialized explanation': 2,
                    'Differences highlighted': 2,
                    'Advantages (at least 3)': 2
                }
            }
        };

        function gradeExam() {
            let totalScore = 0;
            let maxScore = 100;
            let feedback = '';

            // Grade multiple choice questions (Q1-Q10)
            for (let i = 1; i <= 10; i++) {
                const qName = `q${i}`;
                const selected = document.querySelector(`input[name="${qName}"]:checked`);
                const answer = answers[qName];
                
                if (selected) {
                    if (selected.value === answer.correct) {
                        totalScore += answer.points;
                        feedback += `
                            <div class="feedback feedback-correct">
                                <h4>‚úì Question ${i}: Correct! (${answer.points}/${answer.points} points)</h4>
                                <div class="explanation">
                                    <strong>Explanation:</strong> ${answer.explanation}
                                </div>
                            </div>
                        `;
                    } else {
                        feedback += `
                            <div class="feedback feedback-incorrect">
                                <h4>‚úó Question ${i}: Incorrect (0/${answer.points} points)</h4>
                                <p><strong>Your answer:</strong> ${selected.value.toUpperCase()}</p>
                                <p><strong>Correct answer:</strong> ${answer.correct.toUpperCase()}</p>
                                <div class="explanation">
                                    <strong>Explanation:</strong> ${answer.explanation}
                                </div>
                            </div>
                        `;
                    }
                } else {
                    feedback += `
                        <div class="feedback feedback-incorrect">
                            <h4>‚úó Question ${i}: Not answered (0/${answer.points} points)</h4>
                            <p><strong>Correct answer:</strong> ${answer.correct.toUpperCase()}</p>
                            <div class="explanation">
                                <strong>Explanation:</strong> ${answer.explanation}
                            </div>
                        </div>
                    `;
                }
            }

            // Grade SQL query questions (Q11-Q14)
            for (let i = 11; i <= 14; i++) {
                const qId = `q${i}`;
                const userAnswer = document.getElementById(qId).value.trim().toUpperCase();
                const answer = answers[qId];
                
                if (userAnswer) {
                    const { score, foundKeywords, missingRequired } = gradeWrittenAnswer(
                        userAnswer, 
                        answer.keywords, 
                        answer.requiredKeywords,
                        answer.points
                    );
                    
                    totalScore += score;
                    
                    const isFullCredit = score === answer.points;
                    feedback += `
                        <div class="feedback ${isFullCredit ? 'feedback-correct' : 'feedback-incorrect'}">
                            <h4>${isFullCredit ? '‚úì' : '‚óê'} Question ${i}: ${score.toFixed(1)}/${answer.points} points</h4>
                            <div class="model-answer">
                                <strong>Model Answer:</strong>
                                <pre style="white-space: pre-wrap; font-family: 'Courier New', monospace; background: #f5f5f5; padding: 10px; border-radius: 5px; margin-top: 10px;">${answer.modelAnswer}</pre>
                            </div>
                            <div class="keywords-found">
                                <strong>‚úì Keywords Found:</strong> ${foundKeywords.join(', ') || 'None'}
                                ${missingRequired.length > 0 ? `<br><strong style="color: #d63031;">‚úó Missing Required Keywords:</strong> ${missingRequired.join(', ')}` : ''}
                            </div>
                            <div class="explanation">
                                <strong>Grading Rubric:</strong>
                                <ul style="margin-left: 20px; margin-top: 10px;">
                                    ${Object.entries(answer.rubric).map(([key, points]) => 
                                        `<li>${key}: ${points} points</li>`
                                    ).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                } else {
                    feedback += `
                        <div class="feedback feedback-incorrect">
                            <h4>‚úó Question ${i}: Not answered (0/${answer.points} points)</h4>
                            <div class="model-answer">
                                <strong>Model Answer:</strong>
                                <pre style="white-space: pre-wrap; font-family: 'Courier New', monospace; background: #f5f5f5; padding: 10px; border-radius: 5px; margin-top: 10px;">${answer.modelAnswer}</pre>
                            </div>
                        </div>
                    `;
                }
            }

            // Grade short answer questions (Q15-Q17)
            for (let i = 15; i <= 17; i++) {
                const qId = `q${i}`;
                const userAnswer = document.getElementById(qId).value.trim().toUpperCase();
                const answer = answers[qId];
                
                if (userAnswer) {
                    const { score, foundKeywords, missingRequired } = gradeWrittenAnswer(
                        userAnswer, 
                        answer.keywords, 
                        answer.requiredKeywords,
                        answer.points
                    );
                    
                    totalScore += score;
                    
                    const isFullCredit = score >= answer.points * 0.9;
                    feedback += `
                        <div class="feedback ${isFullCredit ? 'feedback-correct' : 'feedback-incorrect'}">
                            <h4>${isFullCredit ? '‚úì' : '‚óê'} Question ${i}: ${score.toFixed(1)}/${answer.points} points</h4>
                            <div class="model-answer">
                                <strong>Model Answer:</strong>
                                <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin-top: 10px; white-space: pre-wrap;">${answer.modelAnswer}</div>
                            </div>
                            <div class="keywords-found">
                                <strong>‚úì Keywords/Concepts Found:</strong> ${foundKeywords.join(', ') || 'None'}
                                ${missingRequired.length > 0 ? `<br><strong style="color: #d63031;">‚úó Missing Key Concepts:</strong> ${missingRequired.join(', ')}` : ''}
                            </div>
                            <div class="explanation">
                                <strong>Grading Rubric:</strong>
                                <ul style="margin-left: 20px; margin-top: 10px;">
                                    ${Object.entries(answer.rubric).map(([key, points]) => 
                                        `<li>${key}: ${points} points</li>`
                                    ).join('')}
                                </ul>
                                ${score < answer.points * 0.7 ? `
                                    <p style="margin-top: 10px; color: #d63031;"><strong>Improvement Tips:</strong> Include more detail about ${missingRequired.slice(0, 2).join(' and ')}. Refer to the model answer for complete coverage.</p>
                                ` : ''}
                            </div>
                        </div>
                    `;
                } else {
                    feedback += `
                        <div class="feedback feedback-incorrect">
                            <h4>‚úó Question ${i}: Not answered (0/${answer.points} points)</h4>
                            <div class="model-answer">
                                <strong>Model Answer:</strong>
                                <div style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin-top: 10px; white-space: pre-wrap;">${answer.modelAnswer}</div>
                            </div>
                        </div>
                    `;
                }
            }

            // Calculate percentage and grade
            const percentage = (totalScore / maxScore) * 100;
            let grade, gradeBadgeClass;
            
            if (percentage >= 90) {
                grade = 'A';
                gradeBadgeClass = 'grade-a';
            } else if (percentage >= 80) {
                grade = 'B';
                gradeBadgeClass = 'grade-b';
            } else if (percentage >= 70) {
                grade = 'C';
                gradeBadgeClass = 'grade-c';
            } else {
                grade = 'F';
                gradeBadgeClass = 'grade-f';
            }

            // Display results
            document.getElementById('scoreDisplay').innerHTML = `
                <div>Your Score: ${totalScore.toFixed(1)} / ${maxScore}</div>
                <div style="font-size: 0.8em; margin-top: 10px;">Percentage: ${percentage.toFixed(1)}%</div>
                <div class="grade-badge ${gradeBadgeClass}">${grade}</div>
            `;
            
            document.getElementById('feedback').innerHTML = feedback;
            document.getElementById('results').classList.add('show');
            
            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function gradeWrittenAnswer(userAnswer, keywords, requiredKeywords, maxPoints) {
            const foundKeywords = [];
            const missingRequired = [];
            let keywordScore = 0;
            
            // Check for keywords
            keywords.forEach(keyword => {
                if (userAnswer.includes(keyword.toUpperCase())) {
                    foundKeywords.push(keyword);
                    keywordScore++;
                }
            });
            
            // Check for required keywords
            requiredKeywords.forEach(keyword => {
                if (!userAnswer.includes(keyword.toUpperCase())) {
                    missingRequired.push(keyword);
                }
            });
            
            // Calculate score based on keyword coverage
            const keywordCoverage = foundKeywords.length / keywords.length;
            const requiredCoverage = (requiredKeywords.length - missingRequired.length) / requiredKeywords.length;
            
            // Score formula: 60% required keywords + 40% overall keywords
            let score = (requiredCoverage * 0.6 + keywordCoverage * 0.4) * maxPoints;
            
            // Bonus for comprehensive answers (more than 80% keywords)
            if (keywordCoverage > 0.8) {
                score = Math.min(score * 1.1, maxPoints);
            }
            
            // Penalty for missing required keywords
            if (missingRequired.length > 0) {
                score = Math.min(score, maxPoints * 0.7);
            }
            
            return {
                score: Math.max(0, Math.min(score, maxPoints)),
                foundKeywords,
                missingRequired
            };
        }

        // Add enter key support for better UX
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey && event.key === 'Enter') {
                gradeExam();
            }
        });
    </script>
</body>
</html>